var app,table,entry="area",map=null,areaFather=null,areaObject=null,drawingManager="",centerPolygon="",resize=!1,setup={bindActions:function(){$(".entry-action").click(function(){switch($(this).data("action")){case"addOpen":render.switchTop();break;case"addCancel":render.switchTop(),setup.clearMap();break;case"submit":entryUtil.validateFields()&&!googleMapsFn.checkPointOutArea(centerPolygon)&&entryUtil.entryCrud(entry,"submit");break;case"selectGeoref":$("#georef-modal").modal("show");break;default:console.log("Entry Action UNDEFINED")}}),$("#areaFather").change(function(){setup.clearMap()})},bindTableActions:function(){$(".table-action").click(function(){switch($(this).data("action")){case"edit":setup.clearMap(),entryUtil.entryCrud(entry,"get",$(this).data("id"));break;case"delete":var e=$(this).data("id");app.notify("warning",$.t("notify.warning"),$.t("entry.deleteConfirm",{entry:$.t(entry+".name")}),!0,function(a){a&&(entryUtil.entryCrud(entry,"delete",e),setup.clearMap())});break;default:console.log("Table Action UNDEFINED")}})},bindModalActions:function(){googleMapsFn.addCoordToModal($("#georefs").data("min")),$("#georef-modal").on("shown.bs.modal",function(){""!==$(".y:first").val()?googleMapsFn.lockCoords(!0):googleMapsFn.lockCoords(!1),setup.handleMap()}),$("#georef-modal").on("hidden.bs.modal",function(){googleMapsFn.changeGeorefModal("map")}),$('[data-action="addCoord"]').click(function(){googleMapsFn.addCoordToModal(1)}),$("#map-btn").click(function(){googleMapsFn.changeGeorefModal("map"),setup.handleMap()}),$("#text-btn").click(function(){googleMapsFn.changeGeorefModal("text"),googleMapsFn.lockCoords(!1)}),$("#btn-clear-draw").click(function(){setup.clearDraw()})},clearDraw:function(){googleMapsFn.resetCoordModal($("#georefs").data("min")),googleMapsFn.lockCoords(!1),areaObject&&(areaObject.setMap(null),areaObject=null),drawingManager?drawingManager.setMap(map):setup.initDrawingManager()},clearMap:function(){setup.clearDraw(),areaFather&&(areaFather.setMap(null),areaFather=null),map=null,$("#map").html("")},handleMap:function(){map||setup.loadAreaFather()},loadAreaFather:function(){var e="",a="",n="";$("#areaFather").val()&&"0"!==$("#areaFather").val()?(e=app.api+"api/area/"+$("#areaFather").val(),a="area",n="#00cace"):(e=app.api+"api/property/"+localStorage.getItem("property_id"),a="property",n="#fdb560"),app.loadingAdd();$.ajax({url:e,type:"GET",beforeSend:app.setHeaders}).done(function(e){if(e.georeferencing){var t=e.georeferencing.coordinates.points,o={lat:t[0].y,lng:t[0].x},r=googleMapsFn.latLngFromPoints(t);map=googleMapsFn.drawMapWithResources(o),setup.mapListeners(),(a=googleMapsFn.drawPolygon(r,n,e.id)).setMap(map),googleMapsFn.fitPolygon(a,map),centerPolygon=a,$("#text").hasClass("locked")?setup.loadArea():setup.initDrawingManager()}else $("#map").html('<div class="text-center">'+$.t(app.htmlEncode(a)+".emptyError")+"</div>")}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},loadArea:function(){areaObject=googleMapsFn.drawEditablePolygon(googleMapsFn.latLngFromForm(),"#444444",0,!0),google.maps.event.addListener(areaObject.getPath(),"set_at",function(){googleMapsFn.formFromPoly(areaObject)}),areaObject.setMap(map)},mapListeners:function(){google.maps.event.addDomListener(window,"resize",function(){resize=!0}),map.addListener("idle",function(){resize&&(googleMapsFn.fitPolygon(centerPolygon,map),resize=!1)})},initDrawingManager:function(){(drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!1})).setMap(map),google.maps.event.addListener(drawingManager,"polygoncomplete",function(e){drawingManager.setMap(null),areaObject=e,googleMapsFn.formFromPoly(e),googleMapsFn.checkPointOutArea(centerPolygon)})},tableSetup:function(){var e=[{data:"id",visible:!1,render:function(e){return app.htmlEncode(e)}},{data:"name",render:function(e){return e?app.htmlEncode(e):"-"}},{data:"levelBase",render:function(e){return e?$.t("options.yes"):$.t("options.no")}},{data:"areaFather",render:function(e){return e?app.htmlEncode(e.name):"-"}},{data:null,render:function(e){return render.renderActions(e.id,e.id,e.locked)}}];entryUtil.tableLoad(e,!1)},populateSelects:function(){entryUtil.populateSelect("area",["name"],!0,"/areabase/true",void 0,void 0,!1,$.t("select.values.none"))},init:function(e){console.log("entryArea.js"),document.title=$.t("area.title"),app=e,this.bindActions(),this.bindModalActions(),this.populateSelects(),this.tableSetup()}};