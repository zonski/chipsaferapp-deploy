var app,table,areaFather,areaProperty,drawingManager,centerPolygon,entry="property",map="",areaLoadedId=0,overlays=[],colorList=["#512525","#03722C","#06E052","#00ff3b"],resize=!1,setup={bindActions:function(){$(".entry-action").click(function(){switch($(this).data("action")){case"submit":entryUtil.validateFields()&&entryUtil.entryCrud(entry,"submit");break;case"selectGeoref":$("#georef-modal").modal("show");break;default:console.log("Entry Action UNDEFINED")}}),$("#areaFather").change(function(){setup.clearMap()})},populateSelects:function(){$("#country").bind("change",function(e){entryUtil.populateSelect("state",["name"],!1,"/GetAll/"+this.value,void 0,void 0,!1),entryUtil.populateSelectWithSpecifiedComboData("property","timezone",["name"],!1,"/timezones/"+$("#country").find(":selected").data("langcode"))}),$("#state").bind("change",function(e){entryUtil.populateSelect("city",["name"],!1,"/GetAll/"+this.value,void 0,void 0,!1)}),entryUtil.populateSelect("country",["name"],!1,"/getall")},bindModalActions:function(){googleMapsFn.addCoordToModal($("#georefs").data("min")),$("#georef-modal").on("shown.bs.modal",function(){""!==$(".y:first").val()?googleMapsFn.lockCoords(!0):googleMapsFn.lockCoords(!1),setup.handleMap()}),$("#georef-modal").on("hidden.bs.modal",function(){googleMapsFn.changeGeorefModal("map")}),$('[data-action="addCoord"]').click(function(){googleMapsFn.addCoordToModal(1)}),$("#map-btn").click(function(){googleMapsFn.changeGeorefModal("map"),setup.handleMap()}),$("#text-btn").click(function(){googleMapsFn.changeGeorefModal("text"),googleMapsFn.lockCoords(!1)}),$("#btn-clear-draw").click(function(){setup.clearDraw()})},handleMap:function(){map||setup.loadProperty()},loadProperty:function(){app.loadingAdd(),$.ajax({url:app.api+"api/property/georeferencing/"+localStorage.getItem("property_id"),type:"GET",beforeSend:app.setHeaders}).done(function(e){if(e.georeferencing){googleMapsFn.deleteOverlays(overlays),overlays=[];var a=e.georeferencing.coordinates.points,o={lat:a[0].y,lng:a[0].x},t=googleMapsFn.latLngFromPoints(a);map||(map=googleMapsFn.drawMap(o),setup.mapListeners()),setup.showProperty(t),googleMapsFn.showOverlays(overlays,map)}else $("#map").html('<div class="text-center">'+$.t("property.emptyError")+"</div>")}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},showProperty:function(e){var a=googleMapsFn.drawEditablePolygon(e,setup.getColor(0),0,!0);a.setOptions({zIndex:0}),googleMapsFn.fitPolygon(a,map),areaProperty=a,a.addListener("click",setup.areaClick),google.maps.event.addListener(a.getPath(),"set_at",function(){googleMapsFn.formFromPoly(a)}),overlays.push(a)},clearDraw:function(){googleMapsFn.resetCoordModal($("#georefs").data("min")),googleMapsFn.lockCoords(!1),areaProperty&&(areaProperty.setMap(null),areaProperty=null),drawingManager?drawingManager.setMap(map):setup.initDrawingManager()},clearMap:function(){setup.clearDraw(),areaFather&&(areaFather.setMap(null),areaFather=null),map=null,$("#map").html("")},getColor:function(e){var a=e<colorList.length?e:e%colorList.length;return colorList[a]},mapListeners:function(){google.maps.event.addDomListener(window,"resize",function(){resize=!0}),map.addListener("idle",function(){resize&&(googleMapsFn.fitPolygon(centerPolygon,map),resize=!1)})},initDrawingManager:function(){(drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!1})).setMap(map),google.maps.event.addListener(drawingManager,"polygoncomplete",function(e){drawingManager.setMap(null),areaProperty=e,googleMapsFn.formFromPoly(e),googleMapsFn.checkPointOutArea(centerPolygon)})},loadData:function(){app.loadingAdd(),$.ajax({url:app.api+"api/property/"+localStorage.getItem("property_id"),type:"GET",async:!1,beforeSend:app.setHeaders}).done(function(e){entryUtil.populateEdit(e)}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},init:function(e){console.log("entryProperty.js"),document.title=$.t("menu.property.title"),app=e,this.bindActions(),this.bindModalActions(),this.populateSelects(),this.loadData()}};