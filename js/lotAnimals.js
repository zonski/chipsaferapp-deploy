var app,entry="lotAnimals";setup={bindActions:function(){$("#back-btn").click(function(){window.location.href="associateLot.html"}),$(".entry-action").click(function(){entryUtil.entryCrud(entry,"submit","","#entry-add")})},bindTableActions:function(){$('span[data-action="addAnimal"]').click(function(){var a=$(this).data("id"),e=$("#destination").DataTable(),n=!1;e.rows().every(function(e,t,i){this.data().id==a&&(app.notify("warning",$.t("notify.warning"),$.t("lot.enrolledAnimal"),!1,!1),n=!0)}),n||e.row.add({id:a,name:$(this).parents("tr").find("span")[1].innerText,status:"new"}).draw()})},tableSetup:function(){var a=[{data:"id",responsivePriority:1,render:function(a){return'<span data-action="addAnimal" data-id="'+a+'" style="cursor:pointer" class="icon icon-plus-alt"></span>'}},{data:null,render:function(a){return setup.getColumn(a)}}];setup.tableLoad("animal","/false",a,"source"),columnsLots=[{data:"id",render:function(a){return'<span data-action="removeAnimal" data-id="'+a+'" style="cursor:pointer" class="glyphicon glyphicon-minus-sign"></span>'}},{data:"name",render:function(a){var e="";return a.gender?(e+=app.htmlEncode(a.code),null!=a.code&&a.code.length>0?e+=a.nickName?app.htmlEncode(" - "+a.nickName):"":e+=a.nickName?app.htmlEncode(a.nickName):"",e+=a.subSpecies.name?app.htmlEncode(" ("+a.subSpecies.name):"",e+=a.pelage.name?app.htmlEncode(" - "+a.pelage.name):"",e+=" - ",1===a.gender?e+=$.t("animal.fields.genderMale"):2===a.gender&&(e+=$.t("animal.fields.genderFemale")),e+=" )"):e=a,"<span>"+e+"</span>"}},{data:"status",visible:!1,render:function(a){return app.htmlEncode(a)}}],$.ajax({async:!1,url:app.api+"api/animal/listbylot/"+app.getUrlParam("id"),type:"POST",contentType:"application/x-www-form-urlencoded",beforeSend:app.setHeaders}).done(function(a){table=$("#destination").DataTable({paging:!0,searching:!0,info:!0,dom:"ftip",columns:columnsLots,language:{url:"locales/"+app.locale+"/translation.json"},fixedHeader:{header:!0}}),$.each(a,function(a,e){table.row.add({id:e.id,name:e,status:"enrolled"})}),table.draw()}),$("#excludedItensList").DataTable({searching:!1,paging:!1,info:!1,oLanguage:{sEmptyTable:"",sZeroRecords:""},columns:[{data:"id",visible:!1,render:function(a){return app.htmlEncode(a)}}]})},getColumn:function(a){var e="<span>"+app.htmlEncode(a.code);return null!=a.code&&a.code.length>0?e+=a.nickName?app.htmlEncode(" - "+a.nickName):"":e+=a.nickName?app.htmlEncode(a.nickName):"",e+=a.subSpecies.name?app.htmlEncode(" ("+a.subSpecies.name):"",e+=a.pelage.name?app.htmlEncode(" - "+a.pelage.name):"",e+=" - ",1===a.gender?e+=$.t("animal.fields.genderMale"):2===a.gender&&(e+=$.t("animal.fields.genderFemale")),(e+=")")+"</span>"},tableLoad:function(a,e,n,t,i){$("#"+t).DataTable({lengthChange:!1,ordering:!1,info:!0,responsive:!1,serverSide:!0,paging:!0,searching:!0,dom:"ftip",language:{url:"locales/"+app.locale+"/translation.json"},ajax:{url:app.api+"api/"+a+"/list"+e,type:"POST",beforeSend:app.setHeaders,error:function(a){app.ajaxError(a)}},preDrawCallback:function(){app.loadingAdd()},drawCallback:function(){setup.bindTableActions(),app.loadingRemove()},initComplete:function(){$('input[type="search"]').attr("placeholder",$.t("entry.search")).attr("maxlength",50),$("#"+t).show()},columns:n})},populateSelects:function(){},getLot:function(){var a=app.getUrlParam("id");$.ajax({url:app.api+"api/lot/"+a,type:"GET",beforeSend:app.setHeaders}).done(function(a){$("#animalsInLot").html($.t("lot.animalsInLot",{name:app.htmlEncode(a.name)}))}).fail(function(a){app.ajaxError(a)})},init:function(a){app=a,document.title=$.t("associateLot.title"),this.bindActions(),this.populateSelects(),this.tableSetup(),this.getLot(),$(document).ready(function(){$("#destination").DataTable().draw()}),$(document).on("click",'span[data-action="removeAnimal"]',function(){var a=$("#destination").DataTable(),e=$("#excludedItensList").DataTable(),n=$(this).parents("tr")[0];"enrolled"==$(n).find("td")[2].innerHTML&&e.row.add({id:$($(n).find("td span")[0]).data("id")}).draw(),a.row($(this).parents("tr")).remove().draw()})}};