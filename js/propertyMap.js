var app,map,area,areaLoadedId=0,resize=!1,overlays=[],colorList=["#512525","#03722C","#06E052","#00ff3b"],setup={loadArea:function(e){areaLoadedId=e,app.loadingAdd();$.ajax({url:app.api+"api/propertyGeolocation/"+e,type:"GET",beforeSend:app.setHeaders}).done(function(e){if(e.georeferencing){googleMapsFn.deleteOverlays(overlays),overlays=[];var o=e.georeferencing.coordinates.points,a={lat:o[0].y,lng:o[0].x},r=googleMapsFn.latLngFromPoints(o);map||(map=googleMapsFn.drawMap(a),setup.mapListeners()),setup.showProperty(r),setup.showArea(e.area),setup.showAnimal(e.animal),googleMapsFn.showOverlays(overlays,map)}else $("#map").html('<div class="text-center">'+$.t("property.emptyError")+"</div>")}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},mapListeners:function(){google.maps.event.addDomListener(window,"resize",function(){resize=!0}),map.addListener("idle",function(){resize&&(googleMapsFn.fitPolygon(area,map),resize=!1)})},showProperty:function(e){var o=googleMapsFn.drawPolygon(e,setup.getColor(0),0);o.setOptions({zIndex:0}),0===areaLoadedId&&(googleMapsFn.fitPolygon(o,map),area=o),o.addListener("click",setup.areaClick),overlays.push(o)},showArea:function(e){$.each(e,function(){if(this.georeferencing){var e=googleMapsFn.latLngFromPoints(this.georeferencing.coordinates.points),o=googleMapsFn.drawPolygon(e,setup.getColor(this.levelHierarquical),this.id);o.setOptions({zIndex:this.levelHierarquical}),o.addListener("click",setup.areaClick),this.id==areaLoadedId&&(googleMapsFn.fitPolygon(o,map),area=o),overlays.push(o),setup.showArea(this.areaChildren),setup.showResource(this.resource)}})},showAnimal:function(e){$.each(e,function(){var e=this.nickName?this.nickName:"";e+=e?" - ":"",e+=this.code?this.code:"";var o=googleMapsFn.latLngFromPoints([this.geolocation.point]),a=googleMapsFn.drawMarker(o,this.id,"32-boi.png",e);a.setOptions({zIndex:999}),overlays.push(a)})},showResource:function(e){$.each(e,function(){if(this.georeferencing&&this.georeferencing.coordinates){var e,o=googleMapsFn.latLngFromPoints(this.georeferencing.coordinates.points);"Polygon"==this.resourceModel.resourceType.geometryType?e=googleMapsFn.drawPolygon(o,"#FFA440",0):"Line"==this.resourceModel.resourceType.geometryType?e=googleMapsFn.drawPolyline(o,"#0FA3FF",3,0):"Point"==this.resourceModel.resourceType.geometryType&&(e=googleMapsFn.drawMarker(o,this.id,"32-arvore.png",this.code)),e.setOptions({zIndex:999}),overlays.push(e)}})},areaClick:function(){this.id?setup.loadArea(this.id):setup.loadArea(0)},getColor:function(e){var o=e<colorList.length?e:e%colorList.length;return colorList[o]},init:function(e){console.log("propertyMap.js"),app=e,this.loadArea(0)}};