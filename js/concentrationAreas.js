var app,columns,center,map,overlays=[],resize=!1,filtered=!1,setup={bindActions:function(){$(".report-action").click(function(){switch($(this).data("action")){case"apply":$("#georef-modal").modal("show");break;default:console.log("Report Action UNDEFINED")}})},bindModalActions:function(){googleMapsFn.addCoordToModal($("#georefs").data("min")),$("#georef-modal").on("shown.bs.modal",function(){overlays.length>0&&(googleMapsFn.deleteOverlays(overlays),map=null),map||setup.loadProperty()})},loadProperty:function(){app.loadingAdd(),$.ajax({url:app.api+"api/property/georeferencing/"+localStorage.getItem("property_id"),type:"GET",beforeSend:app.setHeaders}).done(function(e){if(e.georeferencing){googleMapsFn.deleteOverlays(overlays),overlays=[];var o=e.georeferencing.coordinates.points,t=googleMapsFn.latLngFromPoints(o);center={lat:o[0].y,lng:o[0].x},map||(map=googleMapsFn.drawMap(center),setup.mapListeners()),setup.showProperty(t),setup.loadClusterPoints(),googleMapsFn.showOverlays(overlays,map)}else $("#map").html('<div class="text-center">'+$.t("property.emptyError")+"</div>")}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},showProperty:function(e){var o=googleMapsFn.drawPolygon(e,"#fdb560",0);o.setOptions({zIndex:0}),googleMapsFn.fitPolygon(o,map),overlays.push(o)},mapListeners:function(){google.maps.event.addDomListener(window,"resize",function(){resize=!0}),map.addListener("idle",function(){resize&&(googleMapsFn.fitPolygon(centerPolygon,map),resize=!1)})},loadClusterPoints:function(){app.loadingAdd();var e=entryUtil.buildEntryJson("#entry-add");$.ajax({url:app.api+"api/concentration/apply",type:"POST",data:e,beforeSend:app.setHeaders}).done(function(e){var o,t,n,a,l=setup.createClusters(e),r=[];for(o=0;o<l.length;o++)for(n={path:google.maps.SymbolPath.CIRCLE,fillColor:setup.clusterColors(o),fillOpacity:.7,scale:7,strokeColor:"#000",strokeWeight:1},t=0;t<l[o].length;t++)r[r.length]=new google.maps.LatLng(l[o][t].lat,l[o][t].lng),a=new google.maps.Marker({icon:n,title:"teste",position:new google.maps.LatLng(l[o][t].lat,l[o][t].lng),map:map}),overlays.push(a)}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},createClusters:function(e){var o=[],t=[];if(e.length>0){var n,a=e.length;for(n=0;n<a;n++)t=[],$.each(e[n].geolocations,function(){t.push({lat:this.point.y,lng:this.point.x})}),o[o.length]=t}return o},clusterColors:function(e){return 0==e?"blue":1==e?"red":2==e?"green":3==e?"yellow":4==e?"orange":5==e?"crimson":6==e?"purple":7==e?"violet":8==e?"brown":9==e?"black":10==e?"aqua":11==e?"lime":"white"},populateSelects:function(){entryUtil.populateSelect("trajectory",["description"],!1,"/all/")},init:function(e){console.log("concentrationAreas.js"),app=e,setup.bindActions(),setup.bindModalActions(),setup.populateSelects()}};