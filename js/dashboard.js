var app,setup={currencyId:"",drawAnimals:function(t){var a,e=new google.visualization.PieChart(document.getElementById("container-animals")),n=new google.visualization.DataTable;n.addColumn("string","Class."),n.addColumn("number","Number of Animals");for(var o=0,i=t.length;o<i;o++)a=t[o],n.addRow([a.classification.label,a.qtd]);e.clearChart(),e.draw(n,chartUtil.optionsPieChart(!0))},drawAnimalsAge:function(t){var a=new google.visualization.PieChart(document.getElementById("container-age")),e=new google.visualization.DataTable;e.addColumn("string","Age"),e.addColumn("number","Number of Animals");var n=[];n.push(0),n.push(0),n.push(0),n.push(0),n.push(0);for(var o=0,i=t.length;o<i;o++)t[o]>=0&&t[o]<=12&&(n[0]=parseInt(n[0])+1),t[o]>=13&&t[o]<=24&&(n[1]=parseInt(n[1])+1),t[o]>=25&&t[o]<=36&&(n[2]=parseInt(n[2])+1),t[o]>=37&&t[o]<=48&&(n[3]=parseInt(n[3])+1),t[o]>48&&(n[4]=parseInt(n[4])+1);to=$.t("dashboard.animalsAge.to"),months=$.t("dashboard.animalsAge.months"),above=$.t("dashboard.animalsAge.above"),e.addRow(["0 "+to+" 12 "+months,n[0]]),e.addRow(["13 "+to+" 24 "+months,n[1]]),e.addRow(["25 "+to+" 36 "+months,n[2]]),e.addRow(["37 "+to+" 48 "+months,n[3]]),e.addRow([above+" 49 "+months,n[4]]),a.clearChart(),a.draw(e,chartUtil.optionsPieChart(!0))},drawAnimalsTraded:function(t,a,e){var n,o,i,r,s,l=new google.visualization.ColumnChart(document.getElementById("container-trans3")),d=new google.visualization.DataTable,u=parseInt(document.getElementById("ddlperiodTraded").value);d.addColumn("string","Months"),d.addColumn("number",$.t("dashboard.animalsTradedChart.purchased")),d.addColumn("number",$.t("dashboard.animalsTradedChart.sold")),d.addColumn("number",$.t("dashboard.animalsTradedChart.slaughter"));for(var g=new google.visualization.DateFormat({pattern:"MMM yyyy"}),c=u;c>0;c--)(n=new Date(Date.now())).setMonth(n.getMonth()+1-c),o=n.getMonth()+1,i=n.getFullYear(),d.addRow([g.formatValue(n),setup.getValueFromListEqualMonthYear(t,i,o,"qtd"),setup.getValueFromListEqualMonthYear(a,i,o,"qtd"),setup.getValueFromListEqualMonthYear(e,i,o,"qtd")]);g=new google.visualization.DateFormat({pattern:"d MMM yyyy"}),n=new Date(Date.now()),s=g.formatValue(n),n.setMonth(n.getMonth()+1-u),r=g.formatValue(n);var h=chartUtil.optionsColumnChart($.t("dashboard.animalsTradedChart.chartLegend",{start:app.htmlEncode(r),end:app.htmlEncode(s)}),$.t("dashboard.axis.animalsAmount"),$.t("dashboard.axis.periodMonth"),"bottom",!1);l.clearChart(),l.draw(d,h)},drawAnimalWeightsChart:function(t){var a,e=new google.visualization.LineChart(document.getElementById("container-animalweighing")),n=new google.visualization.DataTable;n.addColumn("date","Date"),n.addColumn("number",$.t("report.weighing.fields.weight"));for(var o=0,i=t.length;o<i;o++)a=t[o],n.addRow([new Date(a.dateTime),a.weight]);var r=chartUtil.optionsLineChart($.t("dashboard.axis.weightInKg"),$.t("dashboard.axis.periodMonthAndDay"),"bottom",5);e.clearChart(),e.draw(n,r)},drawAnimalLossGainWeightChart:function(t){var a,e=new google.visualization.AreaChart(document.getElementById("container-animalLostGainWeight")),n=new google.visualization.DataTable;n.addColumn("date","Date"),n.addColumn("number",$.t("report.weighing.fields.weight"));for(var o=0,i=t.length;o<i;o++)a=t[o],n.addRow([new Date(a.dateTime),a.weight]);var r=chartUtil.optionsAreaChart($.t("dashboard.axis.weightVariation"),$.t("dashboard.axis.periodMonthAndDay"),"bottom",5);e.clearChart(),e.draw(n,r)},drawClassAverageWeight:function(t){var a=new google.visualization.BarChart(document.getElementById("container-weighing"));a.clearChart();var e=new google.visualization.DataTable;e.addColumn("string","Class."),e.addColumn("number",$.t("dashboard.averageWeightChart.chartLegend")),$.each(t,function(t,a){e.addRow([t,a])}),a.draw(e,{is3D:!0,hAxis:{minValue:0}})},drawBirthAndDeath:function(t,a){var e,n,o,i=new google.visualization.LineChart(document.getElementById("container-birth")),r=new google.visualization.DataTable;r.addColumn("string","Months"),r.addColumn("number",$.t("dashboard.birthDeathChart.births")),r.addColumn("number",$.t("dashboard.birthDeathChart.deaths"));for(var s=new google.visualization.DateFormat({pattern:"MMM yyyy"}),l=parseInt(document.getElementById("ddlperiodbirth").value);l>0;l--)(e=new Date(Date.now())).setMonth(e.getMonth()+1-l),n=e.getMonth(),o=e.getFullYear(),r.addRow([s.formatValue(new Date(o,n-1)),setup.getValueFromListEqualMonthYear(t,o,n,"qtd"),setup.getValueFromListEqualMonthYear(a,o,n,"qtd")]);var d=chartUtil.optionsLineChart($.t("dashboard.axis.animalsAmount"),$.t("dashboard.axis.periodMonth"),"bottom",3);i.clearChart(),i.draw(r,d)},drawCustomers:function(t){var a,e=new google.visualization.PieChart(document.getElementById("container-trans1")),n=new google.visualization.DataTable;n.addColumn("string","Class."),n.addColumn("number","Sales");for(var o=0,i=t.length;o<i;o++)a=t[o],n.addRow([a.customerSupplier.name,a.qtd]);e.clearChart(),e.draw(n,chartUtil.optionsPieChart(!1,.3))},createAnimalAcitivyTooltip:function(t,a){var e='<div class="tooltip-chart">';e+="<strong>"+$.t("dashboard.axis.timeDay")+"</strong>: "+t+" (",e+=t<10?"0"+t+":00:00 - 0"+t+":59:59":t+":00:00 - "+t+":59:59",e+=")<br>";var n=new google.visualization.NumberFormat({fractionDigits:2});return e+"<strong>"+$.t("dashboard.approximateDistanceChart.distance")+"</strong>: "+n.formatValue(a)+"m</div>"},drawDistanceByTimeOfDay:function(t){var a=new google.visualization.ColumnChart(document.getElementById("container-trans5"));a.clearChart();var e,n=new google.visualization.DataTable;n.addColumn("string","Hours"),n.addColumn("number",$.t("dashboard.approximateDistanceChart.distanceInMeters")),n.addColumn({type:"string",role:"tooltip",p:{html:!0}});for(var o=t.dicAnimalActivy,i=0;i<24;i++)null!=(e=o[i])?n.addRow([""+i,e.distanceInMeters,setup.createAnimalAcitivyTooltip(i,e.distanceInMeters)]):n.addRow([""+i,0,setup.createAnimalAcitivyTooltip(i,0)]);var r={title:$.t("dashboard.approximateDistanceChart.chartLegend",{animal:app.htmlEncode(t.animal)}),vAxis:{title:$.t("dashboard.axis.distanceTraveled")},hAxis:{title:$.t("dashboard.axis.timeDay")},tooltip:{isHtml:!0},legend:{position:"bottom"}};a.draw(n,r)},drawDistanceDuringDay:function(t){var a=new google.visualization.LineChart(document.getElementById("container-trans6"));a.clearChart();var e,n,o=new google.visualization.DataTable;o.addColumn("timeofday","Hours"),o.addColumn("number",$.t("dashboard.approximateDistanceChart.distanceInMeters"));for(var i=t.listAnimalActivityIndicator,r=0,s=i.length;r<s;r++)e=i[r],n=new Date(e.dateTime),o.addRow([[n.getHours(),n.getMinutes(),n.getSeconds()],e.distanceInMeters]);var l=chartUtil.optionsLineChart($.t("dashboard.approximateDistanceChart.chartLegend",{animal:app.htmlEncode(t.animal)}),$.t("dashboard.axis.distanceTraveled"),$.t("dashboard.axis.timeDay"),"bottom",3);a.draw(o,l)},drawNumberOfWeight:function(t){var a=new google.visualization.ColumnChart(document.getElementById("container-number-weights"));a.clearChart();var e,n=new google.visualization.DataTable;n.addColumn("string","Animals"),n.addColumn("number",$.t("animal.fields.genderMale")),n.addColumn("number",$.t("animal.fields.genderFemale"));var o=new google.visualization.DateFormat({pattern:"MMM yyyy"});$.each(t,function(t,a){(e=new Date(Date.now())).setMonth(a[0].month-1),e.setYear(a[0].year),n.addRow([o.formatValue(e),a[0].qtd,a[1].qtd])});var i=chartUtil.optionsColumnChart("",$.t("dashboard.axis.amountOfWeighing"),$.t("dashboard.axis.periodMonth"),!0);a.draw(n,i)},drawSuppliers:function(t){var a,e=new google.visualization.PieChart(document.getElementById("container-trans2")),n=new google.visualization.DataTable;n.addColumn("string","Class."),n.addColumn("number","Purchases");for(var o=0,i=t.length;o<i;o++)a=t[o],n.addRow([a.customerSupplier.name,a.qtd]);e.clearChart(),e.draw(n,chartUtil.optionsPieChart(!1,.3))},formatCurrencyAcordingLocale:function(t){return"en"==t?new google.visualization.NumberFormat({decimalSymbol:".",groupingSymbol:","}):new google.visualization.NumberFormat({decimalSymbol:",",groupingSymbol:"."})},drawTradingValues:function(t,a,e){var n,o,i,r=new google.visualization.ColumnChart(document.getElementById("container-trans4")),s=new google.visualization.DataTable;numberOfMonths=parseInt(document.getElementById("ddlperiodTradedValue").value),s.addColumn("string","Months"),s.addColumn("number",$.t("dashboard.animalsTradedChart.purchased")),s.addColumn("number",$.t("dashboard.animalsTradedChart.sold")),s.addColumn("number",$.t("dashboard.animalsTradedChart.slaughter"));for(var l=new google.visualization.DateFormat({pattern:"MMM yyyy"}),d=numberOfMonths;d>0;d--)(n=new Date(Date.now())).setMonth(n.getMonth()+1-d),o=n.getMonth()+1,i=n.getFullYear(),s.addRow([l.formatValue(n),setup.getValueFromListEqualMonthYear(t,i,o,"totalValue"),setup.getValueFromListEqualMonthYear(a,i,o,"totalValue"),setup.getValueFromListEqualMonthYear(e,i,o,"totalValue")]);var u=setup.formatCurrencyAcordingLocale(app.locale.substring(0,2));u.format(s,1),u.format(s,2),u.format(s,3),l=new google.visualization.DateFormat({pattern:"d MMM yyyy"}),n=new Date(Date.now()),endDate=l.formatValue(n),n.setMonth(n.getMonth()+1-numberOfMonths),startDate=l.formatValue(n);var g=chartUtil.optionsColumnChart($.t("dashboard.animalsTradingValueChart.chartLegend",{start:app.htmlEncode(startDate),end:app.htmlEncode(endDate)}),$.t("dashboard.axis.value",{entry:$("#currency option:selected").text()}),$.t("dashboard.axis.periodMonth"),"bottom",!1);g.vAxis.format="decimal",r.clearChart(),r.draw(s,g)},getAnimalsAge:function(){entryUtil.getJsonData("animalindicator/animalage/"+document.getElementById("ddlperiodage").value,"GET").then(function(t){setup.drawAnimalsAge(t)})},getAnimalsTraded:function(){var t=new Date(Date.now());t.setMonth(t.getMonth()+1-parseInt(document.getElementById("ddlperiodTraded").value));var a=[],e=[],n=[],o="transactionindicator/animalsTraded/"+t.getDay()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();entryUtil.getJsonData(o,"GET").then(function(t){$.each(t.dictionary,function(t,o){0==t?a=o:1==t?e=o:n=o}),setup.drawAnimalsTraded(a,e,n)})},getAnimalWeightsOnLast12months:function(){var t=document.getElementById("animalsWithWeights").value,a=new Date(Date.now());a.setMonth(a.getMonth()+1-12),entryUtil.getJsonData("weighingindicator/animalWeightsByTime/"+t+"/"+a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),"GET").then(function(t){setup.drawAnimalWeightsChart(t)})},getAnimalLostGainWeightOnLast12months:function(){var t=parseInt(document.getElementById("animalsWithLostGainWeight").value),a=new Date(Date.now());a.setMonth(a.getMonth()+1-12),entryUtil.getJsonData("weighingindicator/animalLossGainWeightByTime/"+t+"/"+a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),"GET").then(function(t){setup.drawAnimalLossGainWeightChart(t)})},getBirthData:function(){var t=new Date(Date.now());t.setMonth(t.getMonth()+1-parseInt(document.getElementById("ddlperiodbirth").value));var a=t.getMonth(),e=t.getFullYear();entryUtil.getJsonData("animalindicator/birth/"+a.toString()+"/"+e.toString(),"GET").then(function(t){var a=[],e=[];$.each(t,function(t,n){"birth"==n.type?a.push(n):e.push(n)}),setup.drawBirthAndDeath(a,e)})},getClassificationProportionData:function(){entryUtil.getJsonData("animalindicator/proportion/","GET").then(function(t){setup.drawAnimals(t)})},getNumberOfWeightsByTime:function(){var t=new Date(Date.now());t.setMonth(t.getMonth()+1-parseInt(document.getElementById("periodNumberWeights").value)),entryUtil.getJsonData("weighingindicator/numberOfWeights/"+t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear(),"GET").then(function(t){setup.drawNumberOfWeight(t)})},getClassificationWeightAverageData:function(){entryUtil.getJsonData("weighingindicator/weightAverage/"+document.getElementById("gender").value,"GET").then(function(t){setup.drawClassAverageWeight(t)})},getCustomerProportionData:function(){var t=[];entryUtil.getJsonData("transactionindicator/customer/proportion/","GET").then(function(a){$.each(a.list,function(a,e){t.push(e)}),setup.drawCustomers(t)})},getSupplierProportionData:function(){var t=[];entryUtil.getJsonData("transactionindicator/supplier/proportion/","GET").then(function(a){$.each(a.list,function(a,e){t.push(e)}),setup.drawSuppliers(t)})},populateAnimalsWithTwoOrMoreWeights:function(){var t=$("#animalsWithWeights"),a=$("#animalsWithLostGainWeight"),e=new Date(Date.now());t.empty(),a.empty(),e.setMonth(e.getMonth()+1-12),entryUtil.getJsonData("animal/animalsWithTwoOrMoreWeights/"+e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),"GET").then(function(e){var n="",o="";$.each(e,function(t,a){n+='<option value="'+a.id+'">'+a.nickName+"</option>",o+='<option value="'+a.id+'">'+a.nickName+"</option>"}),t.append(n),a.append(o),setup.getAnimalWeightsOnLast12months(),setup.getAnimalLostGainWeightOnLast12months()})},populateCurrencySelect:function(){var t=$("#currency");t.empty(),entryUtil.getJsonData("currency/getAllWithOneSelected/","GET").then(function(a){var e="";$.each(a,function(t,a){1==a.select?(setup.maskCurrency=a.mask,setup.currencyId=a.id,e+='<option value="'+a.id+'" data-mask="'+a.mask+'" selected>'+a.name+"</option>"):e+='<option value="'+a.id+'" data-mask="'+a.mask+'">'+a.name+"</option>"}),t.append(e),setup.getTradingValues()})},populateDeviceSelect:function(){var t=$("#deviceDistancePerHour"),a=$("#deviceDistanceDay");t.empty(),a.empty(),entryUtil.getJsonData("device/getAllTrajectoryAssociated/","GET").then(function(e){var n="",o="";$.each(e,function(t,a){n+='<option value="'+a.id+'">'+a.code+"</option>",o+='<option value="'+a.id+'">'+a.code+"</option>"}),t.append(n),a.append(o),setup.populateTrdaysDistancePerHourSelect(),setup.populateTrdaysDistanceDaySelect()})},populateTrdaysDistancePerHourSelect:function(){var t=$("#trdaysDistancePerHour");t.empty(),entryUtil.getJsonData("trajectory/datesFromDevice/"+document.getElementById("deviceDistancePerHour").value,"GET").then(function(a){var e="";$.each(a,function(t,a){e+='<option value="'+a.id+'">'+app.htmlEncode(app.getDateTime(a.dateTrajectory))+"</option>"}),t.append(e),setup.getDistanceByTimeOfDay()})},populateTrdaysDistanceDaySelect:function(){var t=$("#trdaysDistanceDay");t.empty(),entryUtil.getJsonData("trajectory/datesFromDevice/"+document.getElementById("deviceDistanceDay").value,"GET").then(function(a){var e="";$.each(a,function(t,a){e+='<option value="'+a.id+'">'+app.htmlEncode(app.getDateTime(a.dateTrajectory))+"</option>"}),t.append(e),setup.getDistanceDuringDay()})},getDistanceByTimeOfDay:function(){var t=document.getElementById("trdaysDistancePerHour").value;entryUtil.getJsonData("monitoringIndicator/approximateDistanceByTimeOfDay/"+t,"GET").then(function(t){setup.drawDistanceByTimeOfDay(t)})},getDistanceDuringDay:function(){var t=document.getElementById("trdaysDistanceDay").value;entryUtil.getJsonData("monitoringIndicator/approximateDistanceDuringDay/"+t,"GET").then(function(t){setup.drawDistanceDuringDay(t)})},getTradingValues:function(){var t=new Date(Date.now());t.setMonth(t.getMonth()+1-parseInt(document.getElementById("ddlperiodTradedValue").value));var a=[],e=[],n=[],o="transactionindicator/tradingValues/"+setup.currencyId+"/"+t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();entryUtil.getJsonData(o,"GET").then(function(t){$.each(t.dictionary,function(t,o){0==t?a=o:1==t?e=o:n=o}),setup.drawTradingValues(a,e,n)})},getValueFromListEqualMonthYear:function(t,a,e,n){for(var o,i=0,r=t.length;i<r;i++)if((o=t[i]).year==a&&o.month==e)return"qtd"==n?o.qtd:o.totalValue;return 0},init:function(t){console.log("dashboard.js"),app=t;var a=new Date(Date.now());$(".animalsMonthChart").append($("<span>&nbsp;"+(a.getMonth()+1)+"/"+a.getFullYear()+"</span>")),google.charts.load("current",{callback:function(){google.charts.setOnLoadCallback(setup.getClassificationProportionData),google.charts.setOnLoadCallback(setup.getAnimalsAge),google.charts.setOnLoadCallback(setup.getBirthData),$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){switch(t.target.id){case"animals-tab":google.charts.setOnLoadCallback(setup.getClassificationProportionData),google.charts.setOnLoadCallback(setup.getAnimalsAge),google.charts.setOnLoadCallback(setup.getBirthData);break;case"weighing-tab":google.charts.setOnLoadCallback(setup.getNumberOfWeightsByTime),google.charts.setOnLoadCallback(setup.getClassificationWeightAverageData),google.charts.setOnLoadCallback(setup.populateAnimalsWithTwoOrMoreWeights);break;case"transaction-tab":google.charts.setOnLoadCallback(setup.getCustomerProportionData),google.charts.setOnLoadCallback(setup.getSupplierProportionData),google.charts.setOnLoadCallback(setup.getAnimalsTraded),google.charts.setOnLoadCallback(setup.populateCurrencySelect);case"monitoring-tab":google.charts.setOnLoadCallback(setup.populateDeviceSelect)}})},packages:["corechart"],language:app.locale.substring(0,2)}),$(document).ready(function(){$("#ddlperiodbirth").change(function(){setup.getBirthData()}),$("#ddlperiodTraded").change(function(){setup.getAnimalsTraded()}),$("#ddlperiodTradedValue").change(function(){setup.getTradingValues()}),$("#ddlperiodage").change(function(){setup.getAnimalsAge()}),$("#deviceDistancePerHour").change(function(){setup.populateTrdaysDistancePerHourSelect()}),$("#deviceDistanceDay").change(function(){setup.populateTrdaysDistanceDaySelect()}),$("#periodNumberWeights").change(function(){setup.getNumberOfWeightsByTime()}),$("#animalsWithWeights").change(function(){setup.getAnimalWeightsOnLast12months()}),$("#animalsWithLostGainWeight").change(function(){setup.getAnimalLostGainWeightOnLast12months()}),$("#gender").change(function(){setup.getClassificationWeightAverageData()}),$("#trdaysDistancePerHour").change(function(){setup.getDistanceByTimeOfDay()}),$("#trdaysDistanceDay").change(function(){setup.getDistanceDuringDay()})}),$(document).on("change","#currency",function(){setup.currencyId=$("#currency").find(":selected").val(),setup.getTradingValues()})}};