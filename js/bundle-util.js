var googleMapsFn={drawMapWithResources:function(e){return new google.maps.Map(document.getElementById("map"),{center:e,zoom:16,minZoom:10,disableDefaultUI:!0,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,mapTypeId:"satellite",scrollwheel:!0,draggable:!1,disableDoubleClickZoom:!0})},drawMap:function(e){return new google.maps.Map(document.getElementById("map"),{center:e,zoom:16,minZoom:10,disableDefaultUI:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!1,rotateControl:!0,fullscreenControl:!0,mapTypeId:"satellite",scrollwheel:!0,draggable:!0,disableDoubleClickZoom:!1})},drawPolygon:function(e,t,a){return t||(t=""),a||(a=""),new google.maps.Polygon({paths:e,strokeColor:t,strokeOpacity:.9,strokeWeight:3,fillColor:t,fillOpacity:.5,id:a})},drawEditablePolygon:function(e,t,a,n){var o=googleMapsFn.drawPolygon(e,t,a);return o.setEditable(n),o},drawPolyline:function(e,t,a,n){return new google.maps.Polyline({path:e,strokeColor:t,strokeOpacity:.9,strokeWeight:a,id:n})},drawMarker:function(e,t,a,n){var o=a?"images/icons/"+a:"";return n=time.formatDateTime(e.date)+"\n("+e.lng+", "+e.lat+")\n"+n,new google.maps.Marker({position:{lat:e.lat,lng:e.lng},icon:o,id:t,title:n})},drawMarkerAnimal:function(e,t,a,n,o,i){var r=a?"images/icons/"+a:"",l="("+e.lng+", "+e.lat+")\n";return new google.maps.Marker({position:{lng:e.lng,lat:e.lat},icon:r,id:t,title:l})},drawMarkerArea:function(e,t,a){var n=new google.maps.LatLngBounds;e.forEach(e=>n.extend(new google.maps.LatLng(e.y,e.x)));var o={lat:n.getCenter().lat(),lng:n.getCenter().lng()},i=new google.maps.Marker({position:o,id:"a"+t,label:{text:a+"",color:"white",fontSize:"8px"},map:map});return i.setOptions({zIndex:999}),i},drawMarkerGateway:function(e,t,a,n,o){var i=a?"images/icons/"+a:"",r="("+e.lng+", "+e.lat+")\n",l=new google.maps.Marker({position:{lng:e.lng,lat:e.lat},icon:i,id:t,title:r}),s='<div id="content" class="dialog-marker-animal"><div id="bodyContent"><p><i class="material-icons">description</i><b>'+n+"</b> - "+o+"m</p></div></div>",d=new google.maps.InfoWindow({content:s});return l.addListener("click",function(){d.open(map,l)}),l},drawMarkers:function(e){var t,a=[],n={path:google.maps.SymbolPath.CIRCLE,fillColor:"blue",fillOpacity:.7,scale:7,strokeColor:"#000",strokeWeight:1};for(index=0;index<e.length-1;index++)t=time.formatDateTime(e[index].date)+"\n("+e[index].lng+", "+e[index].lat+")",a[a.length]=new google.maps.Marker({icon:n,title:t,position:new google.maps.LatLng(e[index].lat,e[index].lng)});return a},hideOverlays:function(e){for(var t=0;t<e.length;t++)e[t].setMap(null)},showOverlays:function(e,t){for(var a=0;a<e.length;a++)e[a].setMap(t)},deleteOverlays:function(e){for(;e[0];)e.pop().setMap(null)},fitPolygon:function(e,t){for(var a=e.getPath(),n=new google.maps.LatLngBounds,o=0;o<a.getLength();o++){var i=a.getAt(o);n.extend(i)}t.fitBounds(n)},latLngFromPoints:function(e){var t=[];return $.each(e,function(){var e={};e.lat=this.y,e.lng=this.x,t.push(e)}),t},latLngFromForm:function(){var e=[];return $(".coord-row").each(function(){var t={};t.lat=Number($(this).find(".y").val().replace(",",".")),t.lng=Number($(this).find(".x").val().replace(",",".")),e.push(t)}),e},formFromPoly:function(e){var t=e.getPath(),a=t.getLength();googleMapsFn.resetCoordModal(a);for(var n=$("#georef-modal .x"),o=$("#georef-modal .y"),i=0;i<a;i++)$(o[i]).val(String(t.getAt(i).lat()).replace(".",",")),$(n[i]).val(String(t.getAt(i).lng()).replace(".",","));googleMapsFn.lockCoords(!0)},formFromPoint:function(e){googleMapsFn.resetCoordModal(1);var t=$("#georef-modal .x"),a=$("#georef-modal .y");$(a).val(String(e.lat).replace(".",",")),$(t).val(String(e.lng).replace(".",",")),googleMapsFn.lockCoords(!0)},pointsFromForm:function(){var e="";return $(".coord-row").each(function(){var t=$(this).find(".x").val(),a=$(this).find(".y").val();(t||a)&&(e&&(e+=","),e+="("+String(t).replace(",",".")+",",e+=String(a).replace(",",".")+")")}),!!e&&"("+e+")"},addCoordToModal:function(e){for(var t="",a=0;a<e;a++)t+='<div class="row coord-row"><div class="col-md-6 form-group">',t+='<input type="text" class="form-control number y" maxlength="20">',t+='</div><div class="col-md-6 form-group">',t+='<input type="text" class="form-control number x" maxlength="20">',t+="</div></div>";$("#georefs").append(t),$("#georefs .number.y, #georefs .number.x").on("paste",function(){var e=$(this);setTimeout(function(){var t=e.val().replace(/[^0-9,-]/g,"");e.val(t)},50)})},resetCoordModal:function(e){$("#georefs").html(""),e?googleMapsFn.addCoordToModal(e):googleMapsFn.addCoordToModal($("#georefs").data("min"))},populateCoordinates:function(e,t){var a=t.length;googleMapsFn.resetCoordModal(a);var n=$("#georef-modal .x"),o=$("#georef-modal .y");for(i=0;i<a;i++)$(n[i]).val(String(t[i].x).replace(".",",")),$(o[i]).val(String(t[i].y).replace(".",","));$("#entry-add #georeferencing").data("id",e)},lockCoords:function(e){e?($("#text").addClass("locked"),$(".y, .x").prop("disabled",!0),$("#add-coord-row").hide()):($("#text").removeClass("locked"),$(".y, .x").prop("disabled",!1),$("#add-coord-row").show(),$(".y:first").focus())},changeGeorefModal:function(e){"text"===e?($("#georef-modal .modal-dialog, #georef-modal .modal-content").removeClass("draw-map").addClass("type-coord"),$("#map-btn").removeClass("btn-primary").addClass("btn-default"),$("#text-btn").removeClass("btn-default").addClass("btn-primary")):"map"===e?($("#georef-modal .modal-dialog, #georef-modal .modal-content").removeClass("type-coord").addClass("draw-map"),$("#map-btn").removeClass("btn-default").addClass("btn-primary"),$("#text-btn").removeClass("btn-primary").addClass("btn-default")):console.log("Mode UNDEFINED")},checkPointOutArea:function(e){var t=!1,a=googleMapsFn.latLngFromForm();return e&&$.each(a,function(){var a=new google.maps.LatLng(this.lat,this.lng);this.lat&&this.lng&&!google.maps.geometry.poly.containsLocation(a,e)&&(setup.clearDraw(),app.notify("warning",$.t("notify.warning"),$.t("resource.error.invalidPoint"),!1),t=!0)}),t},distanceInMeters:function(e){var t,a=0;for(t=0;t<e.length;t++)t+1!=e.length&&(a+=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(e[t].lat,e[t].lng),new google.maps.LatLng(e[t+1].lat,e[t+1].lng)));return a.toFixed(2)},distance:function(e,t){return google.maps.geometry.spherical.computeDistanceBetween(e,t).toFixed(2)}},render={renderActions:function(e,t,a,n){var o='<div class="table-row-controls" style="width: 80px;">';return e&&(o+='<a data-action="edit" ',void 0!==n&&(o+='data-type="'+n+'" '),o+='data-id="'+e+'" class="table-action material-icons',o+='">edit</a>'),t&&(o+="<a ",a||(o+='data-action="delete" '),o+='data-id="'+t+'" class="',a||(o+="table-action "),o+="material-icons",a&&(o+=" disabled"),o+='">close</a>'),o+="</div>"},renderTrajectoryActions:function(e,t){var a='<div class="table-row-controls dropdown show" style="width: 80px;">';return e&&(a+='<a data-action="animalMovement" ',a+='data-id="'+e+'" class="table-action icon icon-globe',a+='"></a>'),t&&(a+='<a class="table-action icon icon-download dropdown-toggle" id="dropdownMenuLink"',a+='data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></a>',a+='<ul class="dropdown-menu trajectory-menu" aria-labelledby="dropdownMenuLink">',a+='<li><img src="images/icons/pdficon.png"/><a href="#" data-id="'+t+'" data-action="downloadDataInPDF"',a+='class="table-action">'+$.t("trajectoryAnimal.format.pdf")+"</a></li>",a+='<li><img src="images/icons/excelicon.png"/><a href="#" data-id="'+t+'" data-action="downloadDataInXLSX"',a+='class="table-action">'+$.t("trajectoryAnimal.format.excel")+"</a></li>",a+="</ul>"),a+="</div>"},renderTrajectoryInfo:function(e,t,a,n,o){document.getElementById("start").innerHTML=e,document.getElementById("end").innerHTML=t,document.getElementById("duration").innerHTML=a,document.getElementById("numCoordinates").innerHTML=n,document.getElementById("distance").innerHTML=o+"m"},renderTrajectoryPeriod:function(e){var t="";1==e?(t+='<div class="col-md-2 form-group"><label>'+$.t("trajectoryAnimal.fields.dateStart")+"</label>",t+='<input type="text" class="form-control field required datepicker" id="dateStart">',t+='<span class="input-tooltip icon icon-calendar-2"></span></div>',t+='<div class="col-md-2 form-group"> <label>'+$.t("trajectoryAnimal.fields.dateEnd")+"</label>",t+='<input type="text" class="form-control field required datepicker" id="dateEnd">',t+='<span class="input-tooltip icon icon-calendar-2"></span></div>'):2==e?(t+='<div class="col-md-3 form-group"><label>'+$.t("trajectoryAnimal.fields.dateTimeStart")+"</label>",t+='<input type="text" class="form-control field" id="dateStartWithTime">',t+='<span class="input-tooltip icon icon-calendar-2"></span></div>',t+='<div class="col-md-3 form-group"><label>'+$.t("trajectoryAnimal.fields.dateTimeEnd")+"</label>",t+='<input type="text" class="form-control field" id="dateEndWithTime">',t+='<span class="input-tooltip icon icon-calendar-2"></span></div>'):3==e&&(t+='<div class="col-md-2 form-group"><label>'+$.t("trajectoryAnimal.fields.dateStart")+"</label>",t+='<input type="text" class="form-control field required datepicker" id="dateStart">',t+='<span class="input-tooltip icon icon-calendar-2"></span></div>',t+='<div class="col-md-2 form-group"><label>'+$.t("trajectoryAnimal.fields.dateEnd")+"</label>",t+='<input type="text" class="form-control field required datepicker" id="dateEnd">',t+='<span class="input-tooltip icon icon-calendar-2"></span></div>',t+='<div class="col-md-2 form-group"><label>'+$.t("trajectoryAnimal.fields.timeStart")+"</label>",t+='<input type="text" class="form-control field" id="timeStart">',t+='<span class="input-tooltip icon icon-clock-1"></span></div>',t+='<div class="col-md-2 form-group"><label>'+$.t("trajectoryAnimal.fields.timeEnd")+"</label>",t+='<input type="text" class="form-control field" id="timeEnd">',t+='<span class="input-tooltip icon icon-clock-1"></span></div>'),$("#period-component").html(t)},clearTrajectoryInfo:function(){document.getElementById("footer-firstline").innerHTML="",document.getElementById("footer-secondline").innerHTML=""},clearTrajectoryPeriod:function(){document.getElementById("period-component").innerHTML=""},renderAssociationActions:function(e,t){var a='<div class="table-row-controls" style="width: 80px;">';return e&&(a+='<a href="lotAnimals.html?id='+e+'" class="table-action material-icons',a+='">arrow_right_alt</a>',a+='<a href="lotsAnimals.html?id='+e+"&name="+t+'" class="table-action material-icons',a+='">compare_arrows</a>'),a+="</div>"},switchTop:function(e,t,a){a=a||"#entry-add","none"===$("#entry-title").css("display")&&!e||t?($(a).removeClass("add-panel--active"),$(a).hide(),$("#entry-title").show(),$(".entry-table").css("margin-top",0),entryUtil.clearAdd(a)):($("#entry-title").hide(),$(a).addClass("add-panel--active"),$(a).show(),$(".entry-table").css("margin-top",25),$(a+" input[type=text], "+a+" input[type=number], "+a+" select").length>0?$(a+" input[type=text], "+a+" input[type=number], "+a+" select")[0].focus():$(a+" input, "+a+" select")[1].focus())}},time={formatDateTime:function(e){return void 0===e?"":time.extractDate(e)+" "+time.extractTime(e)},extractDate:function(e){var t=e.split("T")[0].split("-");return t[2]+"/"+t[1]+"/"+t[0]},extractTime:function(e){return e.split("T")[1]},duration:function(e,t){var a=new moment.duration(new Date(t)-new Date(e)),n=moment.duration(a).seconds(),o=moment.duration(a).minutes(),i=Math.trunc(moment.duration(a).asHours());return i<10&&(i="0"+i),o<10&&(o="0"+o),n<10&&(n="0"+n),i+":"+o+":"+n},nextYear:function(){return(new Date).getFullYear()+1}},sidebarBuilder={createMenuItens:e=>{var t=[],a=0;return e.forEach(({name:e,icon:n,i18n:o,href:i,subMenu:r})=>{if('""'==i){var l=`\n                <a data-toggle="collapse" \n                   href="#collapse-${a}" \n                   onClick="app.toggleSidebarCollapse(this)" \n                   class="menu-item a-decorationless">\n                    <li class="menu-item js-menu-item">\n                        <i class="mdi ${n} mdi-18px" aria-hidden="true"></i>\n                        <span>${$.t(o)}</span>\n                        <i class="mdi mdi-chevron-down chevron anchor-right"></i>\n                    </li>\n                </a>\n                <div id=collapse-${a} class="collapse">\n                `;sidebarBuilder.createMenuItens(r).forEach(e=>{l+=e}),l+="</div>",a++,t.push(l)}else t.push(`\n                <a href="${i}" class="menu-legend a-decorationless">\n                    <li class="${'""'!=n?"menu-item":"submenu-item"} js-menu-item \n                               ${window.location.pathname=="/"+i?"menu-item-active":""}">\n                        ${'""'!=n?`<i class="mdi ${n} mdi-18px" aria-hidden="true"></i>`:""}\n                        <span>${$.t(o)}</span>\n                    </li>\n                </a>\n                `)}),t},getMenuItens:()=>new Promise((e,t)=>{$.ajax({url:app.api+"api/menu/getall/",type:"GET",contentType:"application/json; charset=utf-8",beforeSend:app.setHeaders}).done(function(t){e(sidebarBuilder.createMenuItens(t))}).fail(e=>{t(e)})})},entryUtil={currencyToFloat:function(e){var t=entryUtil.formatStringToDecimal(e);return parseFloat(t)},formatStringToDecimal:function(e){var t=e.toString(),a=t.lastIndexOf(",");return a>-1&&(t=t.length-1-a==2?t.substring(0,a).replace(/[.]/g,"")+"."+t.substring(a+1,t.length):t.replace(/[, ]/g,"")),t},formatStringToCurrency:function(e,t,a){var n={minimumFractionDigits:2,style:"currency",currency:a};return parseFloat(entryUtil.formatStringToDecimal(e)).toLocaleString(t,n).replace(/^\D+/g,"")},tableInitCompleted:function(e,t){$("#entry-table_length").parent().parent().addClass("entry-table_summary"),$("#entry-table_length").parent().removeClass("col-sm-6").addClass("col-sm-3").addClass("entry-table_pages"),$("#entry-table_length").parent().next().after('<div class="col-sm-3"></div>').addClass("entry-table_search"),$("#entry-table_filter input").attr("placeholder",$.t("entry.search")).attr("maxlength",50),e.buttons().container().appendTo($(".col-sm-12:eq(1)",e.table().container())),$("#entry-table").parent().parent().addClass("entry-table_content"),t||$("#showHideColumns").hide(),$("#entry-table").show(),t&&setup.createDropdownMenu()},multiselectInitCompleted:function(){$("#multiselect-table_filter input").parents().eq(1).removeClass("col-sm-6").addClass("col-xs-12"),$("#multiselect-table_filter input").attr("placeholder",$.t("entry.search")).attr("maxlength",50),$("#multiselect-table").show()},tableLoad:function(e,t){table=$("#entry-table").DataTable({processing:!0,serverSide:!0,ordering:!1,responsive:!1,buttons:[{text:'<span class="tableheader-button-icon hand">view_column</span>',className:"show-hide-columns",titleAttr:$.t("button.showHideColumns"),attr:{id:"showHideColumns",role:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}}],language:{url:"locales/"+app.locale+"/translation.json"},ajax:{url:app.api+"api/"+entry+"/list",type:"POST",beforeSend:app.setHeaders,error:function(e){app.ajaxError(e)}},preDrawCallback:function(){app.loadingAdd()},drawCallback:function(){setup.bindTableActions(),app.loadingRemove()},initComplete:function(){entryUtil.tableInitCompleted(table,t)},columns:e}),$.fn.dataTable.Buttons.defaults.dom.button.className="dt-button"},multiselectLoad:function(e,t){$("#multiselect-table").DataTable({lengthChange:!1,ordering:!1,serverSide:!1,scrollY:"380px",scrollCollapse:!0,paging:!1,searching:!0,dom:"ft",language:{url:"locales/"+app.locale+"/translation.json"},ajax:{url:app.api+"api/"+e+"/GetAllDTO",type:"POST",beforeSend:app.setHeaders,error:function(e){app.ajaxError(e)}},preDrawCallback:function(){app.loadingAdd()},drawCallback:function(){app.loadingRemove()},initComplete:function(){entryUtil.multiselectInitCompleted()},columns:t})},populateSelect:function(e,t,a,n,o,i,r,l,s,d){n||(n=""),o||(o=""),$('[data-combo="'+e+o+'"]').html('<option value="0">Loading...</option>'),r=!!r,$.ajax({url:app.api+"api/"+e+n,type:"GET",async:r,beforeSend:app.setHeaders}).done(function(n){var r="";a&&(r+='<option value="0" ',void 0!==s&&1==s&&(r+="disabled selected"),r+=">",void 0!==l&&(r+=l),r+="</option>"),$.each(n,function(){var a=this,n=a.id,o="";if($.each(t,function(){null!==a[String(this)]&&(o&&(o+=" - "),o+=a[String(this)])}),i){for(var l="",s=i.split("."),c=0;c<s.length;c++)c>0&&l[String(s[c])]?l=l[String(s[c])]:a[String(s[c])]&&(l=a[s[c]]);r+='<option value="'+n+'" data-'+app.htmlEncode(s[s.length-1])+'="'+app.htmlEncode(l)+'">'+app.htmlEncode(o)+"</option>"}else{var p="";"country"==e&&(p=' data-langcode="'+a.languageCode+'"'),r+='<option value="'+n+'"'+p,d&&(r+='option-default="'+a.defaultValue+'"',a.defaultValue&&(r+=" selected")),r+=">"+app.htmlEncode(o)+"</option>"}}),$('[data-combo="'+e+o+'"]').html(r).change()}).fail(function(e){app.ajaxError(e)})},populateSelectWithSpecifiedComboData:function(e,t,a,n,o,i,r,l,s,d,c){o||(o=""),i||(i=""),$('[data-combo="'+t+i+'"]').html('<option value="0">Loading...</option>'),l=!!l,$.ajax({url:app.api+"api/"+e+o,type:"GET",async:l,beforeSend:app.setHeaders}).done(function(e){var o="";n&&(o+='<option value="0" ',void 0!==d&&1==d&&(o+="disabled selected"),o+=">",void 0!==s&&(o+=s),o+="</option>"),$.each(e,function(){var e=this,t=e.id,n="";if($.each(a,function(){null!==e[String(this)]&&(n&&(n+=" - "),n+=e[String(this)])}),r){for(var i="",l=r.split("."),s=0;s<l.length;s++)s>0&&i[String(l[s])]?i=i[String(l[s])]:e[String(l[s])]&&(i=e[l[s]]);o+='<option value="'+t+'" data-'+app.htmlEncode(l[l.length-1])+'="'+app.htmlEncode(i)+'">'+app.htmlEncode(n)+"</option>"}else o+='<option value="'+t+'"',c&&(o+='option-default="'+e.defaultValue+'"',e.defaultValue&&(o+=" selected")),o+=">"+app.htmlEncode(n)+"</option>"}),$('[data-combo="'+t+i+'"]').html(o).change()}).fail(function(e){app.ajaxError(e)})},populateInput:function(e,t,a,n,o,i,r){entryUtil.setAutoComplete(e,n,[],o,i,r),entryUtil.getAutoCompleteData(e,n,t,a)},getAutoCompleteData:function(e,t,a,n){n=n||"",$.ajax({url:app.api+"api/"+e+n,type:"GET",beforeSend:app.setHeaders}).done(function(n){var o=[];$.each(n,function(){var e=this,t=e.id,n={label:"",id:0,value:""};$.each(a,function(){null!==e[String(this)]&&(n.label?n.label+=" - ":n.id=t,n.label+=e[String(this)])}),n.value=n.label,o.push(n)}),$(t+' input[name="'+e+'"]').autocomplete("option","source",o)}).fail(function(e){app.ajaxError(e)})},setAutoComplete:function(e,t,a,n,o,i){t=t||"",n=n||e,$(t+' input[name="'+e+'"]').autocomplete({source:a,open:function(){$(this).autocomplete("widget").width($(this).css("width"))},select:function(e,a){$(t+" #"+n).val(a.item.id),selected_value=a.item.value,$(this).removeClass("field-error")},change:function(e,a){a.item?($(this).removeClass("field-error"),$(t+" #"+n).val(a.item.id),i&&i(a.item.id)):($(this).addClass("field-error"),$(this).val(""),$(t+" #"+n).val(""),i&&i())}}).change(),$(t+' input[name="'+e+'"]').attr("placeholder",$.t("entry.autoCompletePlaceholder",{placeholder:$.t(o)})),$(t+' input[name="'+e+'"]').after('<span class="input-tooltip glyphicon glyphicon-filter"></span>'),$(t+' input[name="'+e+'"]').parent().css("position","relative")},populateSelectFather:function(e,t,a,n){a||(a=""),n||(n=""),$('[data-combo="'+e+n+'"]').html('<option value="0">Loading...</option>'),$.ajax({url:app.api+"api/"+e+a,type:"GET",beforeSend:app.setHeaders}).done(function(a){var o="";t&&(o+='<option value="0"></option>'),$.each(a,function(){var e="";e+='<optgroup label="'+app.htmlEncode(this.name)+'">',$.each(this.eventTypes,function(){var t=this.id;e+='<option value="'+t+'">'+app.htmlEncode(this.name)+"</option>"}),o+=e+="</optgroup>"}),$('[data-combo="'+e+n+'"]').html(o).change()}).fail(function(e){app.ajaxError(e)})},validateFields:function(e){e=e||"#entry-add";var t,a,n=!0,o=!0,i=!0,r=!0,l=!0,s=!0,d=!0,c="";return entryUtil.clearErrors(),$(e+" select:not(.autocomplete, .no-validate),"+e+" input:not(.autocomplete, .no-validate)").each(function(){if(t=$(this).val(),a=null!=t?t instanceof Array?t.toString():t.trim():"",!$(this).hasClass("required")||t&&a||($(this).addClass("field-error"),n&&(n=!1,c&&(c+="\n"),"date"===$(this).attr("type")?c+=$.t("error.requiredDateError"):c+=$.t("error.requiredError"))),$(this).hasClass("number")){var e=$(this).attr("min"),r=$(this).attr("max");(!/^-?[0-9]?\d*(\,\d+)?$/.test(t)||e&&t<e||r&&t>r)&&($(this).addClass("field-error"),o&&(o=!1,c&&(c+="\n"),c+=$.t("error.numberError")))}"date"===$(this).attr("type")&&(t&&((u=new Date(t).getUTCFullYear())<1753||u>9999)&&($(this).addClass("field-error"),i&&(i=!1,c&&(c+="\n"),console.log("year: "+u),c+=$.t("error.dateError"))));"time"===$(this).attr("type")&&(t&&$(this).attr("min")&&app.getDateTime($(this).attr("min"),"HH:mm","HH:mm")>app.getDateTime(t,"HH:mm","HH:mm")&&($(this).addClass("field-error"),s&&(s=!1,c&&(c+="\n"),c+=$.t("error.timeError"))));if($(this).data("reference")){var d=$("#"+$(this).data("reference")).val();(t&&!d||t&&!d)&&($(this).addClass("field-error"),l&&(l=!1,c&&(c+="\n"),c+=$.t("error.autoCompleteError")))}if($(this).hasClass("datepicker")&&t){moment.locale(app.locale);var p,m=moment.localeData().longDateFormat("L"),u=0;if(2!=(t.match(/\//g)?t.match(/\//g).length:0))p=!0;else{var f=t.lastIndexOf("/");if((u=parseInt(t.substring(f+1)))<1753||u>9999)i=!1;else{var g,h,y=t.indexOf("/");m.substring(0,m.indexOf("/")).includes("D")?(h=t.substring(0,y),g=t.substring(y+1,f)):(g=t.substring(0,y),h=t.substring(y+1,f)),(!moment(u.toString()+"-"+g+"-"+h).isValid()||parseInt(g)>12)&&(i=!1)}}i&&!p||($(this).addClass("field-error"),c+="\n",c+=(u<1753||u>9999)&&!p?$.t("error.dateError"):$.t("error.dateFormatError"))}}),$("#georeferencing").length>0&&$(".coord-row").each(function(){var e=$(this).find(".x").val(),t=$(this).find(".y").val();!e&&!t||e&&t||r&&(r=!1,c&&(c+="\n"),c+=$.t("error.coordError"))}),n&&o&&i&&r&&l&&s||(d=!1,app.notify("error",$.t("notify.error"),c,!1,function(){$(e+" .field-error:first").focus()})),d},populateEdit:function(e){$.each(e,function(e,t){var a=$("#"+e);if(a.hasClass("datepicker")){if(t){var n=new Date(t);$(a).val(n.toLocaleDateString(app.locale))}}else if("date"===a.attr("type"))t&&a.val(app.getDateTime(t));else if(a.is("select"))t&&"object"==typeof t?a.val(t.id).change():null==t?a.val("0").change():a.val(String(t)).change();else if(a.hasClass("autocomplete"))if(t){for(var o='input[data-reference="'+e+'"]',i=$(o).autocomplete("option").source,r=0;r<i.length;r++)if(i[r].id==t.id){$(o).val(i[r].label),a.val(i[r].id),$(o).autocomplete("option","change").call(void 0,void 0,{item:i[r]});break}}else $('input[data-reference="'+e+'"]').val("");else a.hasClass("number")?a.val(String(t).replace(".",",")):"georeferencing"===e?t&&t.coordinates&&googleMapsFn.populateCoordinates(t.id,t.coordinates.points):a.hasClass("multiselect")?(listMultiselect=t,$('#multiselect-modal input[type="checkbox"]').prop("checked",!1),$('#multiselect-modal input[type="text"]').val(""),$.each(t,function(){var e=this.percentage+"";e&&(e=(e=e.replace(",","")).replace(".",",")),$('#multiselect-modal input[type="checkbox"][data-value="'+this.id+'"]').prop("checked",!0),$('#multiselect-modal input[type="text"][data-value="'+this.id+'"]').val(e)})):a.hasClass("station-check")?a.prop("checked",t):a.val(t)}),e&&("animal"==entry&&(animalStatus=$("#animalStatus").find(":selected").val(),4==animalStatus||7==animalStatus?$("#animalStatus").prop("disabled",!0):$("#animalStatus").prop("disabled",!1)),"weightLot"==entry&&(localStorage.setItem("historylotweight",e.id),localStorage.setItem("historylot",e.historyLotId)),"weighAnimals"==entry&&(localStorage.setItem("historyanimalweight",e.id),localStorage.setItem("historyanimal",e.historyAnimalId)),e.coordinates&&(console.log("data.coordinates",e.coordinates),$(".y:first").val(e.coordinates.y),$(".x:first").val(e.coordinates.x)),e.coordinate&&(console.log("data.coordinate",e.coordinate),$(".y:first").val(e.coordinate.y),$(".x:first").val(e.coordinate.x)),e.subSpecies&&($("#subspecies").val(e.subSpecies.id),entryUtil.populateSelect("pelage",["name"],!0,"/getbysubspecies/"+e.subSpecies.id,void 0,void 0,!1,$.t("select.notSelected"),!1)),e.pelage&&$("#pelage").val(e.pelage.id),e.father&&$("#father").val(e.father.id),e.mother&&$("#mother").val(e.mother.id),e.address&&($("#addressId").val(e.address.addressId),$("#street").val(e.address.street),$("#number").val(e.address.number),$("#complement").val(e.address.complement),$("#country").val(e.address.countryId),entryUtil.populateSelect("state",["name"],!1,"/GetAll/"+e.address.countryId,void 0,void 0,!1),$("#state").val(e.address.stateId),entryUtil.populateSelect("city",["name"],!1,"/GetAll/"+e.address.stateId,void 0,void 0,!1),$("#city").val(e.address.cityId)),null!=document.getElementById("timezone")&&(entryUtil.populateSelectWithSpecifiedComboData("property","timezone",["name"],!1,"/timezones/"+$("#country").find(":selected").data("langcode")),e.timezone&&$("#timezone").val(e.timezone))),render.switchTop(!0),$(".white").animate({scrollTop:0})},buildEntryJson:function(e){var t={};if(e=e||"",entryUtil.cleanFilter(),$(e+" .field:not(.ui-autocomplete-input)").each(function(){var e=$(this),a=e.attr("id"),n=e.val();if(e.hasClass("sub"))if(n&&"0"!==n){var o={};if(n instanceof Array){var i,r=n.length,l=[];for(i=0;i<r;i++)o[e.data("sub")]=n[i],l.push(o),o={};t[a]=l}else o[e.data("sub")]=n,e.hasClass("array")?(t[a]||(t[a]=[]),t[a].push(o)):t[a]=o}else t[a]=null;else if(e.hasClass("datepicker")){var s;moment.locale(app.locale),s="pt-BR"==app.locale?"DD/MM/YYYY":moment.localeData().longDateFormat("L"),t[a]=app.getDateTime(n,"YYYY-MM-DD",s)}else if("georeferencing"===a){var d=googleMapsFn.pointsFromForm();if(d)if("gateway"==entry)t.CoordinatesLine=d;else{var c={};c.id=e.data("id"),c.coordinatesLine=d,t[a]=c}else t[a]=null}else e.hasClass("number")?e.hasClass("required")||""!==n?t[a]=n.replace(",","."):t[a]=0:t[a]=n}),$(e+" input:checkbox").each(function(){var e=$(this),a=e.attr("id"),n=e.is(":checked");t[a]=n}),$("#multiselect-modal").each(function(){var e=[],a=$(this).find($("#multiselect-table")).data("name");$(this).find($('input[type="checkbox"]:checked')).each(function(){var t=$(this).data("name"),a={};a[t]=$(this).data("value");var n=$(this).next();if(n.prop("type")&&"text"==n.prop("type")){t=n.data("attribute");var o=n.val();n.hasClass("number")?n.hasClass("required")||""!==o?a[t]=o.replace(",","."):a[t]=0:a[t]=o}e.push(a)}),t[a]=e}),"undefined"!=typeof entry)switch(entry){case"device":var a={};a.batteryAlert=t.batteryAlert,delete t.batteryAlert,a.animalOutAreaAlert=t.animalOutAreaAlert,delete t.animalOutAreaAlert,a.animalOutPropertyAlert=t.animalOutPropertyAlert,delete t.animalOutPropertyAlert,a.anomalyOnDeviceAlert=t.anomalyOnDeviceAlert,delete t.anomalyOnDeviceAlert,a.deviceResetAlert=t.deviceResetAlert,delete t.deviceResetAlert,a.fallenDeviceAlert=t.fallenDeviceAlert,delete t.fallenDeviceAlert,a.returnToActiveAlert=t.returnToActiveAlert,delete t.returnToActiveAlert,delete t.confirmPassword,delete t.currentPassword,delete t.newPassword,t.deviceAlertPermissions=a;break;case"weightLot":if(null!=localStorage.getItem("historylotweight"))t.id=parseInt(localStorage.getItem("historylotweight")),t.historyLotId=parseInt(localStorage.getItem("historylot")),t.lotId=t.lotId.id,delete t.lotID;else{var n={};n.id=t.lotId.id,t.lot=n,delete t.lotID}break;case"weighAnimals":if(null!=localStorage.getItem("historyanimalweight"))t.id=parseInt(localStorage.getItem("historyanimalweight")),t.historyAnimalId=parseInt(localStorage.getItem("historyanimal")),t.animalId=t.animalId.id,delete t.animalID;else{var o={};o.id=t.animalId.id,t.animal=o,delete t.animalID}break;case"lotsAnimals":case"lotAnimals":m=[],(s=$("#destination").DataTable()).rows().every(function(e,t,a){if("new"==this.data().status){var n={},o=this.data().id;n.AnimalId=o?parseInt(o):0,n.ForDeletion=!1,"lotsAnimals"==entry&&(n.LotId=this.data().lotid),m.push(n)}}),s=$("#excludedItensList").DataTable(),$("#excludedItensList").find("tr").each(function(e){if(console.log("excluded item: "+$(this)),e>0&&s.row(this).data()){var t={};console.log(s.row(this).data()),t.AnimalId=s.row(this).data().id,t.ForDeletion=!0,m.push(t)}}),t.itens=m,t.lotID=app.getUrlParam("id");break;case"property":case"customerSupplier":var i={},r={};""!=t.addressId&&(i.addressId=t.addressId),"N/A"!=$("#city").find(":selected").text()&&(i.cityId=t.city.id),""!=t.number&&(i.number=t.number),i.street=t.street,i.complement=t.complement,"property"==entry?(t.timezone=$("#timezone").find(":selected").val(),t.offsetutc=moment().tz($("#timezone").find(":selected").val()).utcOffset()/60):(r.Id=parseInt($("#businessType").val()),t.businessType=r),""==i.street&&void 0===i.cityId||(t.address=i),delete t.street,delete t.addressId,delete t.city,delete t.country,delete t.state,delete t.number,delete t.complement;break;case"buyAnimals":case"saleAnimals":case"slaughterSale":var l,s;null!=localStorage.getItem("transactionId")&&(t.id=localStorage.getItem("transactionId"));var d,c,p,m=[];switch(entry){case"buyAnimals":l=$("#buyList").find("#totalBuyingByAnimal").html(),s=$("#buyList").DataTable(),t.customerSupplierId=parseInt(t.supplier.id),delete t.supplier,t.dateTransaction=t.buyingDate,delete t.buyingDate;break;case"saleAnimals":case"slaughterSale":l=$("#saleList").find("#totalSellingByAnimal").html(),s=$("#saleList").DataTable(),t.customerSupplierId=parseInt(t.client.id),delete t.client,t.dateTransaction=t.sellingDate,delete t.sellingDate,delete t.txtValueByAtKg,delete t.txtCarcassYield,delete t.txtLiveWeight}if("slaughterSale"==entry){var u={};d=parseFloat(entryUtil.formatStringToDecimal($("#txtValueByAtKg").val())),u.ValueByAtKg=d,p=parseInt($("#txtCarcassYield").val()),u.CarcassYield=p,c=""==$("#txtLiveWeight").val()?0:parseInt($("#txtLiveWeight").val()),u.TotalWeight=c,""!=$("#SlaughterSaleId").val()&&(u.Id=$("#SlaughterSaleId").val()),t.slaughterSale=u,t.currencyId=$("#client").find(":selected").data("currencyid")}else t.currencyId=$("#currency").find(":selected").data("id"),delete t.currency;l=l.replace(/^\D+/g,"");var f=this.currencyToFloat(l);t.totalValue=f,s.rows().every(function(e,t,a){var n={},o=this.node(),i=$(o).find("td.hide").html();if(n.Id=i?parseInt(i):0,n.ForDeletion=!1,n.AnimalId=this.data().animalId,"slaughterSale"!=entry)n.Value=entryUtil.currencyToFloat($(o).find("td input").val());else{var r=entryUtil.currencyToFloat($(o).find("td div").html());deadWeight=r*(p/100),c>0?n.Value=f/s.rows().length:-1==$("#lblValueByAtKg").text().indexOf("@")?n.Value=d*deadWeight:n.Value=d*deadWeight/15}m.push(n)}),s=$("#excludedItensList").DataTable(),$("#excludedItensList").find("tr").each(function(e){if(console.log("excluded item: "+$(this)),e>0&&s.row(this).data()){var t={};t.Id=s.row(this).data().id,t.AnimalId=s.row(this).data().animalId,t.ForDeletion=!0,m.push(t)}}),t.itens=m,delete t.undefined}return t},cleanFilter:function(){$("#multiselect-modal input[type='search']").val(""),$("#multiselect-table").DataTable().search("").draw()},entryCrud:function(e,t,a,n,o){var i="",r="",l={},s="",d="";switch(o=o||e,e){case"weightLot":case"weighAnimals":s=$.t("weighing.fields.weight");break;case"lotsAnimals":s=$.t("lotAnimals.name");break;case"gateway":s="Gateway";break;default:s=$.t(e+".name")}"submit"===t?((l=entryUtil.buildEntryJson(n)).id&&0!==l.id?(i="PUT",r=$.t("entry.putMsg",{entry:s})):(i="POST",r=$.t("entry.postMsg",{entry:s})),l=JSON.stringify(l)):"delete"===t?(i="DELETE",r=$.t("entry.deleteMsg",{entry:s}),l=null,d="/"+a):"get"===t?(i="GET",l=null,d="/"+a):console.log("CRUD Action UNDEFINED"),app.loadingAdd();$.ajax({url:app.api+"api/"+o+d,type:i,data:l,contentType:"application/json; charset=utf-8",beforeSend:app.setHeaders}).done(function(t){if("GET"===i)switch(entryUtil.populateEdit(t),e){case"device":var a=t.deviceAlertPermissions;$("#batteryAlert").prop("checked",a.batteryAlert),$("#animalOutAreaAlert").prop("checked",a.animalOutAreaAlert),$("#animalOutPropertyAlert").prop("checked",a.animalOutPropertyAlert),$("#anomalyOnDeviceAlert").prop("checked",a.anomalyOnDeviceAlert),$("#deviceResetAlert").prop("checked",a.deviceResetAlert),$("#fallenDeviceAlert").prop("checked",a.fallenDeviceAlert),$("#returnToActiveAlert").prop("checked",a.returnToActiveAlert);break;case"user":0==$("#viewNotifies").is(":checked")?($("#receiveEmailNotifies").prop("checked",!1),$("#receiveEmailNotifies").prop("disabled",!0)):$("#receiveEmailNotifies").prop("disabled",!1);break;case"weighAnimals":case"weightLot":"weightLot"==e?$("#lotId").prop("disabled","disabled"):$("#animalId").prop("disabled","disabled"),$("#weight").focus(),$("#dateWeighing").datepicker("hide")}else{"property"==e?app.notify("success",$.t("notify.success"),r,!1):app.notify("success",$.t("notify.success"),r,!1,function(){if("event"!=e&&"eventDay"!=e&&"taskEvent"!=e&&"saleAnimals"!=e&&"buyAnimals"!=e&&"slaughterSale"!=e&&"lotAnimals"!=e&&"lotsAnimals"!=e)render.switchTop(!1,"DELETE"===i,n),setup.populateSelects(),$(n).hide(),"DELETE"===i&&table.rows()[0].length<2&&table.page()>0?table.page(table.page()-1).draw("page"):table.page(table.page()).draw("page");else switch(e){case"lotsAnimals":setup.tableSetup(null);break;case"lotAnimals":table=$("#source").DataTable(),table.ajax.reload(),table=$("#excludedItensList").DataTable(),table.clear();break;case"saleAnimals":case"buyAnimals":case"slaughterSale":app.changePage("transactions");break;default:var t=$("#calendar").fullCalendar("getDate"),a=$("#calendar").fullCalendar("getView").name;$("#calendar").fullCalendar("destroy"),setup.initCalendar(),$("#calendar").fullCalendar("gotoDate",t),$("#calendar").fullCalendar("changeView",a),"taskEvent"===e&&$("#taskEvent-btn").click()}})}}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})},handleNumber:function(){$("body").on("keyup","input.number",function(e){var t=e.which;if(t<=13)return!0;var a=String.fromCharCode(t);return/[0-9,-]/.test(a)})},clearAdd:function(e){e=e||"#entry-add",$(e+" input").val(""),$(e+" select option:first-child").prop("selected",!0),$(e+' select option[option-default="true"]').prop("selected",!0),$(e+" #georeferencing").data("id","0"),$(e+' input[type="checkbox"]').prop("checked",!1),$('#multiselect-modal input[type="checkbox"]').prop("checked",!1),$('#multiselect-modal input[type="text"]').prop("value",""),$.each($(e+".autocomplete"),function(){var e=$('input[data-reference="'+$(this).attr("id")+'"]');$(e).autocomplete("option","change").call(void 0,void 0,{item:void 0})}),$.each($(e+" input").filter("[value]"),function(){var e=$(this).attr("id"),t=$(this).attr("value");"id"!==e&&$(this).val(t)}),googleMapsFn.resetCoordModal(),entryUtil.clearErrors()},clearErrors:function(){$("#entry-add input, #entry-add select").removeClass("field-error")},getJsonData:function(e,t,a){return $.ajax({async:!1,url:app.api+"api/"+e,type:t||"get",data:null!=a?JSON.stringify(a):a,contentType:"application/json; charset=utf-8",beforeSend:app.setHeaders})}};function initPage(){var e={index:function(e){setup.init(e)},propertyMenu:function(e){setup.init(e)},termConditions:function(e){setup.init(e)},dashboard:function(e){setup.init(e)},home:function(e){setup.init(e)},taskEvent:function(e){setup.init(e)},taskEventView:function(e){setup.init(e)},report:function(e){setup.init(e)},propertyMap:function(e){setup.init(e)},lotAnimals:function(e){setup.init(e)},entry:function(e){setup.init(e),entryUtil.handleNumber()}},t={api:"",action:$("body").attr("data-page"),alertTable:"",locale:localStorage.getItem("i18n")||navigator.language,notifications:void 0===notifyComponent?null:new notifyComponent,tasks:void 0===taskComponent?null:new taskComponent,changePage:function(e){switch(e){case"buyAnimals":case"saleAnimals":case"slaughterSale":null!=localStorage.getItem("transactionId")&&localStorage.removeItem("transactionId")}window.location=e+".html"},setPath:function(){$.ajax(window.location.origin+"/json/frontconfig.dev.json").done(function(a){t.api=a.api,"index"!==t.action?t.isLogged():e[t.action](t)})},isLogged:function(){localStorage.getItem("access_token")||t.logout(),localStorage.getItem("property_id")||"/propertyMenu.html"==window.location.pathname||(window.location.href="propertyMenu.html"),e[t.action](t),t.setPage()},setPage:function(){t.setPartials()},setPartials:function(){$.when($("#sidebar").load(window.location.origin+"/sidebar.html",function(){})).done(function(){$("#navbar").load(window.location.origin+"/navbar.html",function(){t.getRoles(),$.i18n&&$("body").localize(),t.bindLogout(),$("#property-name").html(localStorage.getItem("property_name")+" "),t.isMobile()&&$("#navbar-logo").attr("href","taskEvent.html"),"1"==localStorage.getItem("profile_id")?($('a[data-i18n="menu.setup.user-list-menu"]').parent().show(),$('a[data-i18n="menu.setup.user-menu"]').parent().hide()):($('a[data-i18n="menu.setup.user-list-menu"]').parent().hide(),$('a[data-i18n="menu.setup.user-menu"]').parent().show()),t.notifications.init(),t.adjustScreen(),$('[data-toggle="tooltip"]').tooltip(),$("#alert-modal .modal-footer button").click(function(){$("#alert-modal").modal("hide")}),t.setTaskWindow(),t.setChangePwd(),$("#translate a").click(function(){localStorage.setItem("i18n",$(this).data("value")),window.location.reload()}),$('#translate a[data-value="'+t.locale+'"]').parent().addClass("active"),$("#setupBox").find("a").css("filter","grayscale(100%)"),$("#setupBox").find("a[data-value='"+t.locale+"']").css("filter",""),$("#setupBox .property-name").html(localStorage.getItem("property_name")+" "),$(".tooltip-chipsafer").parent().tooltip({show:null,position:{my:"left top",at:"left bottom"},using:function(e,t){$(this).css(e),$("<div>").addClass("arrow").addClass(t.vertical).addClass(t.horizontal).appendTo(this)},open:function(e,t){t.tooltip.animate({top:t.tooltip.position().top+10},"fast")}}),sidebarBuilder.getMenuItens().then(e=>{e.forEach(e=>{$("#sidebar-content").append(e)})})})}),$(window).resize(function(){t.adjustScreen()})},setChangePwd:function(){$("#open-change-pwd-modal").click(function(e){$("#change-pwd-modal").modal("show")}),$("#btn-close-change-pwd").click(function(){$("#change-pwd-modal").modal("hide"),$("#currentPassword").val(""),$("#newPassword").val(""),$("#confirmPassword").val("")}),$("#currentPassword").focusout(function(){""!==$(this).val()&&$(this).removeClass("field-error")}),$("#newPassword").focusout(function(){""!==$(this).val()&&$(this).removeClass("field-error")}),$("#confirmPassword").focusout(function(){""!==$(this).val()&&$(this).removeClass("field-error")}),$("#btn-save-change-pwd").click(function(){var e=!0;if($("#change-pwd-fields input[type='password']").each(function(){val=$(this).val(),trimval=val.trim(),!$(this).hasClass("required")||val&&trimval?$(this).removeClass("field-error"):($(this).addClass("field-error"),e&&(e=!1,$.t("error.requiredError")))}),e){t.loadingAdd();var a=entryUtil.buildEntryJson("#changePasswordForm"),n=$.t("user.passwordChangeSuccess");$.ajax({url:t.api+"api/user/changepwd",type:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",beforeSend:t.setHeaders}).done(function(e){t.notify("success",$.t("notify.success"),n,!1,null)}).fail(function(e){t.ajaxError(e)}).always(function(){$("#currentPassword").val(""),$("#newPassword").val(""),$("#confirmPassword").val(""),t.loadingRemove()});$("#change-pwd-modal").modal("hide")}})},setTaskWindow:function(){$("#open-task-modal").click(function(e){$("#task-modal").modal("show"),t.tasks.init()})},translate:function(){var e=t.locale.toLowerCase();"en-us"!==e&&"pt-br"!==e&&"es-ar"!==e&&(t.locale="pt-BR"),i18next.use(i18nextXHRBackend).init({lng:t.locale,load:"currentOnly",fallbackLng:!1,backend:{loadPath:"/locales/{{lng}}/translation.json"},useCookie:!0,getAsync:!1},function(e,a){jqueryI18next.init(i18next,$,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"i18n-target",optionsAttr:"i18n-options",useOptionsAttr:!1,parseDefaultValueFromContent:!0}),$("body").localize().show(),"dashboard"===t.action&&$("#calendar").fullCalendar("render"),$("head").localize().show(),$.datepicker.regional[t.locale]={closeText:$.t("datepicker.closeText"),prevText:$.t("datepicker.prevText"),nextText:$.t("datepicker.nextText"),currentText:$.t("datepicker.currentText"),monthNames:[$.t("datepicker.monthNames.january"),$.t("datepicker.monthNames.february"),$.t("datepicker.monthNames.march"),$.t("datepicker.monthNames.april"),$.t("datepicker.monthNames.may"),$.t("datepicker.monthNames.june"),$.t("datepicker.monthNames.july"),$.t("datepicker.monthNames.august"),$.t("datepicker.monthNames.september"),$.t("datepicker.monthNames.october"),$.t("datepicker.monthNames.november"),$.t("datepicker.monthNames.december")],monthNamesShort:[$.t("datepicker.monthNamesShort.january"),$.t("datepicker.monthNamesShort.february"),$.t("datepicker.monthNamesShort.march"),$.t("datepicker.monthNamesShort.april"),$.t("datepicker.monthNamesShort.may"),$.t("datepicker.monthNamesShort.june"),$.t("datepicker.monthNamesShort.july"),$.t("datepicker.monthNamesShort.august"),$.t("datepicker.monthNamesShort.september"),$.t("datepicker.monthNamesShort.october"),$.t("datepicker.monthNamesShort.november"),$.t("datepicker.monthNamesShort.december")],dayNames:[$.t("datepicker.dayNames.sunday"),$.t("datepicker.dayNames.monday"),$.t("datepicker.dayNames.tuesday"),$.t("datepicker.dayNames.wednesday"),$.t("datepicker.dayNames.thursday"),$.t("datepicker.dayNames.friday"),$.t("datepicker.dayNames.saturday")],dayNamesShort:[$.t("datepicker.dayNamesShort.sunday"),$.t("datepicker.dayNamesShort.monday"),$.t("datepicker.dayNamesShort.tuesday"),$.t("datepicker.dayNamesShort.wednesday"),$.t("datepicker.dayNamesShort.thursday"),$.t("datepicker.dayNamesShort.friday"),$.t("datepicker.dayNamesShort.saturday")],dayNamesMin:[$.t("datepicker.dayNamesMin.sunday"),$.t("datepicker.dayNamesMin.monday"),$.t("datepicker.dayNamesMin.tuesday"),$.t("datepicker.dayNamesMin.wednesday"),$.t("datepicker.dayNamesMin.thursday"),$.t("datepicker.dayNamesMin.friday"),$.t("datepicker.dayNamesMin.saturday")],weekHeader:$.t("datepicker.weekHeader"),dateFormat:$.t("datepicker.dateFormat"),firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},$.datepicker.setDefaults($.datepicker.regional[t.locale]),$(".datepicker").datepicker({yearRange:"1754:9998"}),$(".datepicker").after('<span class="input-tooltip icon icon-calendar-2"></span>'),$(".datepicker").parent().css("position","relative"),t.setPath(),t.highlightMenu()})},changeLanguage:function(e){t.locale=e,i18next.changeLanguage(t.locale,function(){$("body").localize()})},setTokens:function(e,a,n,o,i,r,l,s){localStorage.setItem("expires_in",(new Date).getTime()+1e3*i-5e3),localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",a),localStorage.setItem("username",n),void 0!==s&&localStorage.setItem("acceptanceTerms",s),r&&localStorage.setItem("profile_id",r),l&&localStorage.setItem("user_id",l),t.setPropertyId(o)},setPropertyId:function(e){e&&localStorage.setItem("property_id",e)},refreshToken:function(e){refreshData={username:localStorage.getItem("username"),refresh_token:localStorage.getItem("refresh_token"),grant_type:"refresh_token",property_id:localStorage.getItem("property_id")},t.loadingAdd();$.ajax({url:t.api+"token",type:"POST",data:refreshData,async:!1,beforeSend:t.setHeaders}).done(function(a){t.setTokens(a.access_token,a.refresh_token,refreshData.username,a.property_id,a.expires_in),localStorage.setItem("last_refresh",new Date),e&&(window.location.href=e)}).fail(function(e){t.notify("error",$.t("notify.error"),$.t("error.unauthorized"),!1,t.logout)}).always(function(){t.loadingRemove()})},getRoles:function(){if("/propertyMenu.html"!==window.location.pathname&&"/entryUser.html"!==window.location.pathname){t.loadingAdd();$.ajax({url:t.api+"api/user/roles",type:"GET",async:!1,beforeSend:t.setHeaders}).done(function(e){"/entryUser.html"===window.location.pathname||"/entryProperty.html"===window.location.pathname||e?e||"1"!==localStorage.getItem("profile_id")&&(window.location.href="home.html"):($("#user-link").remove(),"1"!==localStorage.getItem("profile_id")&&$('a[href="entryProperty.html"]').parent().remove())}).fail(function(e){t.ajaxError(e)}).always(function(){t.loadingRemove()})}},setHeaders:function(e,a){-1===a.url.indexOf("token")&&(new Date).getTime()>=localStorage.getItem("expires_in")&&t.refreshToken(),e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("access_token")),e.setRequestHeader("Accept-Language",t.locale)},logout:function(e){var t=window.localStorage.getItem("acceptanceTerms");localStorage.clear(),window.localStorage.setItem("acceptanceTerms",isNaN(t)?"0":t),window.location.href="/"},bindLogout:function(e){$("#logout").click(t.logout)},htmlEncode:function(e){return e?String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},ajaxError:function(e){t.loadingRemove(),0===e.status?t.notify("error",$.t("notify.error"),$.t("error.noConnection")):401===e.status?t.refreshToken():504===e.status?t.notify("error",$.t("notify.error"),$.t("error.timeout")):e.responseText?t.notify("error",$.t("notify.error"),e.responseText):t.notify("error",$.t("notify.error"),$.t("error.ajaxError"))},getDateTime:function(e,t,a){var n=a||"YYYY-MM-DD";if(t=t||"DD/MM/YYYY",!e)return"";var o=e.split("T");return"split"===t?o[0]:"datepicker"===t?new moment(o[0],n)._d:1===o.length?new moment(o[0],n).format(t):(n=a||"YYYY-MM-DD HH:mm:ss",-1===o[1].indexOf("-")?new moment(o[0]+" "+o[1],n).format(t):new moment(o[0]+" "+o[1].split("-")[0],n).format(t))},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Windows Phone|Opera Mini/i.test(navigator.userAgent)},getOrientation:function(){return window.innerHeight>window.innerWidth?"portrait":"landscape"},adjustScreen:function(){t.isMobile()&&($(".white").addClass("white-mobile"),$(".hidden-sm, .hidden-xs").addClass("hidden"),"landscape"===t.getOrientation()?$(".hidden-lg").removeClass("hidden-md"):$(".hidden-lg").addClass("hidden-md"))},toggleSidebar:function(){$(".main-hamburger").toggleClass("active"),$(".sidebar").toggleClass("active"),$(".main-hamburger").blur()},toggleSidebarCollapse:function(e){$($(e.firstElementChild).children()[2]).toggleClass("active")},getUrlParam:function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]===e)return n[1]}},loadingAdd:function(){$("body").css("opacity",.6),$("body").prepend('<div class="loading-div"></div>')},loadingRemove:function(){$(".loading-div").remove(),$("body").css("opacity",1)},notify:function(e,t,a,n,o){$("#notify-modal").length&&($("#notify-modal").remove(),$(".modal-backdrop").remove());var i='<div class="modal fade" id="notify-modal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title"></h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-default" id="btn-false">'+$.t("notify.no")+'</button><button type="button" data-dismiss="modal" class="btn btn-primary" id="btn-true">'+$.t("notify.yes")+"</button></div></div></div></div>";$("body").append(i),$("#notify-modal").modal("show"),n?($("#btn-false").show(),$("#btn-true").text($.t("notify.yes"))):($("#btn-false").hide(),$("#btn-true").text($.t("notify.ok"))),$("#notify-modal").removeClass("success error warning").addClass(e),$("#btn-true").removeClass("btn-primary btn-success btn-error btn-warning").addClass("btn-"+e),$("#notify-modal .modal-body").html(a),$("#notify-modal .modal-title").html(t),$("#notify-modal").on("shown.bs.modal",function(){$("#btn-true").focus()}),$("#btn-false").click(function(){$("#notify-modal").off("hidden.bs.modal").on("hidden.bs.modal",function(e){o&&o(!1)})}),$("#btn-true").click(function(){$("#notify-modal").off("hidden.bs.modal").on("hidden.bs.modal",function(e){o&&o(!0)})}),$("#notify-modal").off("hidden.bs.modal").on("hidden.bs.modal",function(){"none"===$("#btn-false").css("display")?o&&o(!0):o&&o(!1)})},highlightMenu:function(){setTimeout(function(){var e,t,a=window.location.href.split("/");return a=a[a.length-1],e=$(".sidebar__menu").find('a[href="'+a+'"]'),!(a.indexOf("home")>=0)&&(!(a.indexOf("dashboard")>=0)&&(!(a.indexOf("calendar")>=0)&&(t=$(e).parent().attr("id"),$("a[href='#"+t+"']").find("a,span").css("color","#34c3ce"),void $("a[href='#"+t+"']").find("a,i").css("color","#34c3ce"))))},2e3)},init:function(){console.log("app.js"),t.translate(),setTimeout(function(){var e=window.localStorage.getItem("prop-total");if(!isNaN(e)&&1==parseInt(e)){var t=$("#property-name").parent().parent().find("span p:first-child").html();$("#property-name").parent().parent().find("a").remove(),$(".top-bar__property-name").append($("<span>"+t+"</span>"))}},2e3),$("#navbar").load("./navbar.html",function(){document.getElementById("imglogo").addEventListener("load",function(){"4"===localStorage.getItem("property_id")||"12"===localStorage.getItem("property_id")||"14"===localStorage.getItem("property_id")?$("#imglogo").attr("src","images/securitas_logo_2.png"):$("#imglogo").attr("src","images/logo.png")})})}};t.init()}$(initPage);class notifyComponent{constructor(){this.arrayNotify=[],this.timer,this.notificationOverlay=[],this.queueNotifyRead=[],this.showAll=!1,this.heatmap=null,this.clickedNotification=!1,this.lastDates=[moment(),moment()],this.model={message:"",date:new Date,id:0,type:0,deviceType:0,notify:null,deviceCode:null,animalId:0,animalName:null,dateTimeEvent:new Date,lat:0,lng:0,animal:null,trajectory:null,gatewayStatus:null}}get notificationModel(){return jQuery.extend({},this.model)}init(){googleMapsFn.deleteOverlays(this.notificationOverlay),$(".heatmap").hide(),$(".notifyCloud").find(".button__badge").hide(),$(".notifyCloud").bind("click",function(){app.notifications.setReadyNotify(),$(".notifyCloud").find(".button__badge").text("").hide()}),app.notifications.requestNotifications("true"),$("#open-notifies-modal").click(function(e){$("#notifies-modal").modal("show")}),app.notifications.timer=setInterval(function(){app.notifications.requestNotifications("false")},3e4)}requestNotifications(e){try{var t=0;app.notifications.arrayNotify.length>0&&(t=app.notifications.arrayNotify[app.notifications.arrayNotify.length-1].id),$.when(entryUtil.getJsonData("notify/gettop50geo/"+e+"/"+t,"GET").then(function(t){var a=JSON.parse(JSON.stringify(t.data));a&&a.length>0&&(app.notifications.arrayNotify.length=0),$.each(a,function(e,t){void 0==app.notifications.arrayNotify.find(function(e,a,n){return e.id==t.id&&e})&&(app.notifications.verifyIfItemInReadArray(t.id)||(app.notifications.queueNotifyRead.push(t.id),app.notifications.arrayNotify.push(app.notifications.parseData(t))))}),app.notifications.clearTable(),app.notifications.render(),0==a.length&&$("#notifyBox").find("ol").find("li").length<2?($(".heatmap").hide(),$("#notifyBox").find("li:first-child").hide(),$("#notifyBox").find("li:last-child").hide()):($("#notifyBox").find("li:first-child").show(),$(".heatmap").show(),$("#notifyBox").find("li:last-child").show()),a&&"false"==e?(a.length&&($(".notifyCloud").find(".button__badge").show(),$(".notifyCloud").find(".button__badge").text(a.length)),a.length>0&&(app.notifications.lastDates[0]=a[a.length-1].dateTimeEvent)):$(".notifyCloud").find(".button__badge").hide(),0==a.length&&$("#notifyBox").find("ol").find("li").length<2&&$("#notifyBox ol").append($('<li style="background-color:#ffffff;"><center><i class="material-icons">speaker_notes_off</i>&nbsp;&nbsp;'+$.t("alert.modal.empty")+"</center></li>"))})).done(function(){})}catch(e){console.error("Timer notification error",e)}}initTable(){$("#notify-table")&&$("#notify-table").DataTable({responsive:!0,autoWidth:!1,scrollCollapse:!0,columns:[{data:$.t("notificationWindow.datetime"),title:$.t("notificationWindow.datetime"),width:"20%"},{data:$.t("notificationWindow.device-code"),title:$.t("notificationWindow.device-code"),width:"15%"},{data:$.t("notificationWindow.animal"),title:$.t("notificationWindow.animal"),width:"15%"},{data:$.t("notificationWindow.battery"),title:$.t("notificationWindow.battery"),width:"5%"},{data:$.t("notificationWindow.message"),title:$.t("notificationWindow.message"),width:"45%"}],language:{url:"locales/"+app.locale+"/translation.json"}})}clearTable(){var e=$("#notify-table").dataTable();e.fnClearTable(),e.fnDraw(),e.fnDestroy()}render(){app.notifications.arrayNotify.length>0&&($("#notifyBox ol").find("li").remove(),$.each(app.notifications.arrayNotify,function(e,t){var a="";if(0==t.type)switch(t.deviceType){case 7:a="<span class='anomaly-box'><i class='icon material-icons'>arrow_downward</i></span>";break;case 6:a="<span class='reset-box'><i class='icon material-icons'>power_settings_new</i></span>";break;case 3:a="<span class='anomaly-box'><i class='icon material-icons'>report_problem</i></span>";break;case 2:case 1:a="<span class='animal-box'><i class='mdi mdi-cow mdi-36px'></i></span>";break;case 0:a="<span class='battery-box"+(t.batteryPerc<=15?" notify-battery":"")+"'><i class='icon material-icons'>battery_alert</i>"+t.batteryPerc+"%</span>"}else a=0==t.gatewayStatus?"<span class='gateway-offline-box'><i class='icon material-icons'>signal_wifi_off</i></span>":"<span class='gateway-online-box'><i class='icon material-icons'>signal_wifi_4_bar</i></span>";var n=moment(t.date).format("DD/M/YYYY HH:mm:ss"),o="<span><p>"+(""!=t.animalName?"<b>"+t.animalName+"</b>":"")+"<br><i>"+t.message+"</i></p><p>&nbsp;&nbsp;&nbsp;&nbsp;"+n+"</p></span>";if($("#notifyBox ol").append("<li class='notify-row' data-toggle='modal' data-type='notify' data-latitude='"+t.lat+"' data-longitude='"+t.lng+"' data-index='"+e+"'>"+a+o+"</li>"),e>18)return!1})),"undefined"!=typeof google?($("li[data-type='notify']").unbind("mouseover").unbind("mouseout").unbind("click").on("click",function(){app.notifications.clickedNotification=!0}).on("mouseover",function(){app.notifications.removeNotificationOverlay();var e=$(this).attr("data-latitude"),t=$(this).attr("data-longitude"),a=$(this).attr("data-index");app.notifications.showInMap(a,parseFloat(e),parseFloat(t)),app.notifications.clickedNotification=!1}).on("mouseout",function(){app.notifications.clickedNotification||app.notifications.removeNotificationOverlay()}),$($("#notifyBox").find("li:first-child")[0]).find(".see-map").bind("click",function(){app.notifications.showAll?(googleMapsFn.deleteOverlays(app.notifications.notificationOverlay),app.notifications.notificationOverlay=[],app.notifications.showAll=!1):(app.notifications.showAll=!0,app.notifications.showAllInMap())})):$($("#notifyBox").find(".link")[0]).hide(),this.renderTable(),this.initTable()}removeNotificationOverlay(){googleMapsFn.deleteOverlays(app.notifications.notificationOverlay),app.notifications.notificationOverlay=[]}showInMap(e,t,a){app.notifications.showAll=!0,googleMapsFn.deleteOverlays(app.notifications.notificationOverlay),app.notifications.notificationOverlay=[],app.notifications.showAll=!1;google.maps.SymbolPath.CIRCLE;var n={lat:t,lng:a},o=app.notifications.arrayNotify[e],i=app.notifications.createInfoWindow(o,t,a),r=new google.maps.Marker({position:n,icon:"images/icons/pulse2.gif",optimized:!1,map:map});null!==i&&(i.open(map,r),google.maps.event.addListener(i,"domready",function(){$(".gm-style-iw").next("div").click(function(){app.notifications.removeNotificationOverlay()})})),app.notifications.notificationOverlay.push(r)}createInfoWindow(e,t,a){if(void 0==$("#notify-badge-translate").find("li")[0])return null;var n='<div id="content"><div id="siteNotice"></div><div id="bodyContent"><p><b>'+$("#notify-badge-translate").find("li")[0].innerHTML+":</b>&nbsp;"+moment(e.dateTimeEvent).format("DD/M/YYYY HH:mm:ss")+"</p><p><b>"+$("#notify-badge-translate").find("li")[2].innerHTML+":</b>&nbsp;"+e.animalName+"</p><p><b>"+$("#notify-badge-translate").find("li")[1].innerHTML+":</b>&nbsp;"+e.deviceCode+"</p><p><b>"+$("#notify-badge-translate").find("li")[3].innerHTML+":</b>&nbsp;"+e.batteryPerc+"% </p><p>"+e.message+'</p><p><a href="https://www.google.com/maps/?q='+t+","+a+'" target="_blank"><i class="material-icons">map</i>'+$("#notify-badge-translate").find("li")[5].innerHTML+"&nbsp;("+t+","+a+")</a></p></div></div>";return new google.maps.InfoWindow({content:n})}showAllInMap(){googleMapsFn.deleteOverlays(app.notifications.notificationOverlay),app.notifications.notificationOverlay=[],$.each(app.notifications.arrayNotify,function(e,t){var a={path:google.maps.SymbolPath.CIRCLE,fillColor:"red",fillOpacity:.7,scale:7,strokeColor:"#000",strokeWeight:1},n={lat:t.lat,lng:t.lng},o=app.notifications.createInfoWindow(t,t.lat,t.lng),i=new google.maps.Marker({position:n,icon:a,map:map});google.maps.event.addListener(i,"click",function(){null!==o&&o.open(map,i)}),app.notifications.notificationOverlay.push(i)})}renderTable(){var e="";$.each(app.notifications.arrayNotify,function(t,a){e+="<tr>",e+="  <td>"+moment(a.date).format("DD/M/YYYY HH:mm:ss")+"</td>",e+="  <td style='text-align:left;'>"+a.deviceCode+" </td>",e+="  <td>"+a.animalName+"</td>",e+="  <td>"+a.batteryPerc+"%</td>",e+="  <td>"+a.message+"</td>",e+="</tr>"}),$("#notify-table").find("tbody").append(e)}showNotify2Hours(){$(".notify-badge").fadeIn(),$(".notify-badge").unbind("click").bind("click",function(){$(".notify-badge").fadeOut(3e3)}),setTimeout(function(){$(".notify-badge").fadeOut(3e3)},1e4)}parseData(e){var t=app.notifications.notificationModel;try{t.message=e.message,t.date=new Date(e.date),t.id=e.id,t.animalId="",t.animalName=e.animalName,t.deviceCode=e.notifyDevice.code,t.batteryPerc=e.notifyDevice.batteryPercentage,t.type=e.type,t.deviceType=e.notifyDevice.type,t.dateTimeEvent=new Date(e.date),t.gatewayStatus=e.notifyGateway.status,null!=e.notifyDevice.coordinate&&(t.lng=e.notifyDevice.coordinate.x,t.lat=e.notifyDevice.coordinate.y)}catch(e){console.error("Error",e)}return t}verifyIfItemInReadArray(e){var t,a=app.notifications.queueNotifyRead.length;for(t=0;t<a;t++)if(app.notifications.queueNotifyRead[t]==e)return!0;return!1}heatMap(){var e=[];return null!=app.notifications.heatmap?(app.notifications.heatmap.setMap(null),app.notifications.heatmap=null,!1):!!app.notifications.arrayNotify&&(!(app.notifications.arrayNotify.length<10)&&($.each(app.notifications.arrayNotify,function(t,a){e.push(new google.maps.LatLng(a.lat,a.lng))}),void(app.notifications.heatmap=new google.maps.visualization.HeatmapLayer({data:e,map:map}))))}setReadyNotify(){if(0==app.notifications.queueNotifyRead.length)return!1;$.ajax({url:app.api+"api/notify/readednotifies",type:"POST",data:{notifyIds:app.notifications.queueNotifyRead},beforeSend:app.setHeaders}).done(function(e){app.notifications.queueNotifyRead.length=0,$(".notifyCloud").find(".button__badge").text("0"),$(".notifyCloud").find(".button__badge").hide()}).fail(function(e){console.error("readednotifies error",e)}).always(function(){app.loadingRemove()})}}class taskComponent{constructor(){this.arrayTasks=[],this.timer,this.columns,this.model={id:0,description:"",eventType:"",dateEvent:new Date,startTime:"",endTime:""}}get taskModel(){return jQuery.extend({},this.model)}init(){$(document).ready(function(){$("#task-table").hide()}),$("#task-table").ready(function(){app.tasks.requestTasks(),$("#task-table").show(),$("#task-table").DataTable().columns.adjust()}),$(window).on("shown.bs.modal",function(){$("#task-table").DataTable().columns.adjust()})}requestTasks(){entryUtil.getJsonData("taskEvent/getAllbyUser/","GET").then(function(e){var t=JSON.parse(JSON.stringify(e));t&&t.length>0&&(app.tasks.arrayTasks.length=0),$.each(t,function(e,t){app.tasks.arrayTasks.push(app.tasks.parseData(t))}),app.tasks.clearTable(),app.tasks.render()})}render(){app.tasks.renderTable(),app.tasks.initTable()}updateDoneTask(e,t){app.loadingAdd();$.ajax({url:app.api+"api/taskEvent/updateTaskDone/"+e,type:"PUT",async:!1,beforeSend:app.setHeaders}).done(function(e){$("#task-table").DataTable().row(t).remove().draw(),app.tasks.arrayTasks.splice(t,1)}).fail(function(e){app.ajaxError(e)}).always(function(){app.loadingRemove()})}renderTable(){var e="";$.each(app.tasks.arrayTasks,function(t,a){e+="<tr>",a.id?e+="  <td hidden>"+a.id+"</td>":e+="  <td hidden> - </td>",a.eventType?e+="  <td>"+a.eventType+"</td>":e+="  <td> - </td>",a.description?e+="  <td>"+a.description+"</td>":e+="  <td> - </td>",e+="  <td>"+moment(a.dateEvent).format("DD/MM/YYYY")+"</td>",e+="  <td>"+a.startTime.substring(0,5)+" - "+a.endTime.substring(0,5)+"</td>",e+='<td><div class="table-row-controls" style="width: 80px;">',e+='<a data-action="finish" ',e+='data-id="'+a.id+'" class="table-action material-icons',e+='">done</a></div></td>',e+="</tr>"}),$("#task-table").find("tbody").append(e)}bindTableActions(){$('a[data-action="finish"]').click(function(){var e=$(this).data("id"),t=$(this).parents("tr");app.notify("warning",$.t("notify.warning"),$.t("entry.finishTask"),!0,function(a){a&&app.tasks.updateDoneTask(e,t)})})}tableInitCompleted(){$("#task-table_length").parent().removeClass("col-sm-6").addClass("col-xs-3"),$("#task-table_filter").parent().removeClass("col-sm-12 col-md-6").addClass("col-xs-12"),$("#task-table_filter input").attr("placeholder",$.t("entry.search")).attr("maxlength",50),$("#task-table").show()}initTable(){$("#task-table")&&$("#task-table").DataTable({responsive:!0,paging:!1,ordering:!1,search:!0,scrollCollapse:!0,language:{url:"locales/"+app.locale+"/translation.json"},drawCallback:function(){app.tasks.bindTableActions()},initComplete:function(){app.tasks.tableInitCompleted()}})}parseData(e){var t=app.tasks.taskModel;try{t.id=e.taskId,t.description=e.description,t.eventType=e.eventTypeDescription,t.dateEvent=new Date(e.date),t.startTime=e.startTime,t.endTime=e.endTime}catch(e){console.error("Error",e)}return t}clearTable(){var e=$("#task-table").dataTable();e.fnClearTable(),e.fnDraw(),e.fnDestroy()}}