var app,entry="lotsAnimals";setup={bindActions:function(){$("#back-btn").click(function(){window.location.href="associateLot.html"}),$(".entry-action").click(function(){entryUtil.entryCrud(entry,"submit","","#entry-add")})},loadSourceTable:function(a){null==a&&(a=$("#source").DataTable()),a.clear(),parseInt($("#lotId").val())>0&&$.ajax({async:!1,url:app.api+"api/animal/listbylot/"+$("#lotId").val(),type:"POST",contentType:"application/x-www-form-urlencoded",beforeSend:app.setHeaders}).done(function(e){$.each(e,function(e,t){a.row.add({id:t.id,name:t})})}),a.draw()},tableSetup:function(a){if(a){var e=[{data:"id",width:"5%",render:function(a){return'<span data-action="addAnimal" data-id="'+a+'" style="cursor:pointer" class="glyphicon glyphicon-plus-sign"></span>'}},{data:"name",width:"95%",render:function(a){return setup.getColumn(a)}}];table=$("#source").DataTable({paging:!0,searching:!0,info:!1,autoWidth:!1,columns:e,language:{url:"locales/"+app.locale+"/translation.json"},fixedHeader:{header:!0}}),setup.loadSourceTable(table),destinationColumns=[{data:"id",render:function(a){return'<span data-action="removeAnimal" data-id="'+a+'" style="cursor:pointer" class="glyphicon glyphicon-minus-sign"></span>'}},{data:"name",render:function(a){return setup.getColumn(a)}},{data:"status",visible:!1,render:function(a){return app.htmlEncode(a)}},{data:"lotid",visible:!1,render:function(a){return app.htmlEncode(a)}}],$.ajax({async:!1,url:app.api+"api/animal/listbylot/"+app.getUrlParam("id"),type:"POST",contentType:"application/x-www-form-urlencoded",beforeSend:app.setHeaders}).done(function(a){table=$("#destination").DataTable({paging:!0,searching:!0,info:!1,dom:"ftip",columns:destinationColumns,language:{url:"locales/"+app.locale+"/translation.json"},fixedHeader:{header:!0}}),$.each(a,function(a,e){table.row.add({id:e.id,name:e,status:"enrolled",lotid:parseInt(app.getUrlParam("id"))})}),table.draw()}),$("#excludedItensList").DataTable({searching:!1,paging:!1,info:!1,oLanguage:{sEmptyTable:"",sZeroRecords:""},columns:[{data:"id",visible:!1,render:function(a){return app.htmlEncode(a)}}]})}else setup.loadSourceTable(null),table=$("#excludedItensList").DataTable(),excluded.clear()},getColumn:function(a){var e="";return a.gender?(e+=app.htmlEncode(a.code),null!=a.code&&a.code.length>0?e+=a.nickName?app.htmlEncode(" - "+a.nickName):"":e+=a.nickName?app.htmlEncode(a.nickName):"",e+=a.subSpecies.name?app.htmlEncode(" ("+a.subSpecies.name):"",e+=a.pelage.name?app.htmlEncode(" - "+a.pelage.name):"",e+=" - ",1===a.gender?e+=$.t("animal.fields.genderMale"):2===a.gender&&(e+=$.t("animal.fields.genderFemale")),e+=" )"):e=a,"<span>"+e+"</span>"},populateSelects:function(){entryUtil.getJsonData("lot/","GET").then(function(a){$.each(a,function(a,e){parseInt(app.getUrlParam("id"))!=e.id&&$("#lotId").append($("<option>",{value:e.id,text:e.name}))})}),$("#lotId").append($("<option>",{value:0,text:$.t("select.values.default")}))},init:function(a){app=a,document.title=$.t("associateLot.title"),setup.bindActions(),setup.populateSelects(),$(document).ready(function(){setup.tableSetup(!0);var a=app.getUrlParam("name");$("#title").html($.t("associateLot.lotToLot.title",{lot:a.replace("%20"," ")})),$("#lot").DataTable().draw()}),$(document).on("click",'span[data-action="addAnimal"]',function(){var a=$(this).data("id"),e=$("#destination").DataTable(),t=!1,n=$(this).parents("tr")[0];e.rows().every(function(e,n,i){this.data().id==a&&(app.notify("warning",$.t("notify.warning"),$.t("lot.enrolledAnimal"),!1,!1),t=!0)}),t||e.row.add({id:a,name:$(n).find("td span")[1].innerHTML,status:"new",lotid:parseInt($("#lotId").val())}).draw()}),$(document).on("click",'span[data-action="removeAnimal"]',function(){var a=$("#destination").DataTable(),e=$("#excludedItensList").DataTable(),t=$(this).parents("tr")[0];"enrolled"==$(t).find("td")[2].innerHTML&&e.row.add({id:$($(t).find("td span")[0]).data("id")}).draw(),a.row($(this).parents("tr")).remove().draw()}),$(document).on("change","#lotId",function(){setup.loadSourceTable(null)})}};