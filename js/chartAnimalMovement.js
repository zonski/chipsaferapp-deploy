var app,id,dateFrom,dateTo,map,resize,animal,overlays=[],setup={bindActions:function(){$("#btn-back").click(function(a){window.location.href="reportAnimal.html"})},chartSetup:function(){id=app.getUrlParam("id"),dateFrom=app.getDateTime(app.getUrlParam("dateFrom"),"MM-DD-YYYY","DD/MM/YYYY"),dateTo=app.getDateTime(app.getUrlParam("dateTo"),"MM-DD-YYYY","DD/MM/YYYY");var a="en-US"===app.locale?dateTo.replace(/-/g,"/"):app.getUrlParam("dateTo"),e="en-US"===app.locale?dateFrom.replace(/-/g,"/"):app.getUrlParam("dateFrom");$.ajax({url:app.api+"api/animal/"+id,type:"GET",async:!1,beforeSend:app.setHeaders}).done(function(n){if(animal=n){var o=animal.code?" - "+animal.code:"",p=animal.nickName?" - "+animal.nickName:"";$("#title-map").append(o+p+" ("+e+" - "+a+")")}}).fail(function(a){app.ajaxError(a)})},loadProperty:function(){app.loadingAdd();$.ajax({url:app.api+"api/property/"+localStorage.getItem("property_id"),type:"GET",async:!1,beforeSend:app.setHeaders}).done(function(a){if(a.georeferencing){var e=a.georeferencing.coordinates.points,n={lat:e[0].y,lng:e[0].x},o=googleMapsFn.latLngFromPoints(e);map||(map=googleMapsFn.drawMap(n),setup.mapListeners()),setup.showProperty(o)}else $("#map").html('<div class="text-center">'+$.t("property.emptyError")+"</div>")}).fail(function(a){app.ajaxError(a)}).always(function(){app.loadingRemove()})},showProperty:function(a){var e=googleMapsFn.drawPolygon(a,"#512525",0);e.setOptions({zIndex:0}),googleMapsFn.fitPolygon(e,map),area=e,overlays.push(e)},mapListeners:function(){google.maps.event.addDomListener(window,"resize",function(){resize=!0}),map.addListener("idle",function(){resize&&(googleMapsFn.fitPolygon(area,map),resize=!1)})},loadAnimalGeoreference:function(){app.loadingAdd();$.ajax({url:app.api+"api/animal/gelocations/"+dateFrom+"/"+dateTo+"/"+id,type:"GET",async:!1,beforeSend:app.setHeaders}).done(function(a){if(a.length>0){var e=[];$.each(a,function(){e.push({lat:this.point.y,lng:this.point.x})});var n=animal.nickName?animal.nickName:"";n+=n?" - ":"",n+=animal.code?animal.code:"",overlays.push(googleMapsFn.drawPolyline(e,"#FFF",2,0)),overlays.push(googleMapsFn.drawMarker(e,animal.id,"32-boi.png",n))}else app.notify("warning",$.t("alert.title"),$.t("chart.animal.noneCoordinates"))}).fail(function(a){app.ajaxError(a)}).always(function(){app.loadingRemove()})},init:function(a){console.log("chartAnimalMovement.js"),app=a,setup.bindActions(),setup.chartSetup(),setup.loadProperty(),setup.loadAnimalGeoreference(),googleMapsFn.showOverlays(overlays,map)}};